<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—°ì„±ëŒ€í•™êµ ìº í¼ìŠ¤ ë‚´ë¹„ê²Œì´ì…˜</title>
    <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=YOUR_CLIENT_ID"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .control-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .search-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
            padding: 12px 20px;
            border: 2px solid #e1e1e1;
            border-radius: 25px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }

        .btn-success {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .status-panel {
            background: linear-gradient(45deg, #a8edea, #fed6e3);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
            color: #333;
        }

        .map-container {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            background: white;
        }

        #map {
            width: 100%;
            height: 500px;
        }

        .building-list {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .building-list h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            text-align: center;
        }

        .building-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .building-item {
            background: linear-gradient(45deg, #ffecd2, #fcb69f);
            padding: 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .building-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .building-item h4 {
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1em;
        }

        .building-item p {
            color: #666;
            font-size: 0.9em;
        }

        .roadview-container {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 200px;
            height: 150px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            background: white;
            z-index: 1000;
            display: none;
        }

        #roadview {
            width: 100%;
            height: 100%;
        }

        .location-info {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 12px;
            margin-top: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .coordinates {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .search-input {
                min-width: auto;
            }
            
            #map {
                height: 400px;
            }
            
            .roadview-container {
                width: 150px;
                height: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ« ì—°ì„±ëŒ€í•™êµ ìº í¼ìŠ¤ ë‚´ë¹„ê²Œì´ì…˜</h1>
            <p>ì‹¤ì‹œê°„ ìœ„ì¹˜ ì¶”ì ê³¼ ì •í™•í•œ ê¸¸ì°¾ê¸° ì„œë¹„ìŠ¤</p>
        </div>

        <div class="control-panel">
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="ê±´ë¬¼ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê³µí•™1ê´€, ë„ì˜ê´€)">
                <button onclick="searchBuilding()" class="btn btn-primary">ğŸ” ê±´ë¬¼ ì°¾ê¸°</button>
                <button onclick="startTracking()" class="btn btn-success" id="trackingBtn">ğŸ“ ìœ„ì¹˜ ì¶”ì  ì‹œì‘</button>
                <button onclick="findRoute()" class="btn btn-secondary" id="routeBtn" disabled>ğŸ›£ï¸ ê¸¸ì°¾ê¸°</button>
                <button onclick="toggleRoadview()" class="btn btn-secondary">ğŸ‘€ ë¡œë“œë·°</button>
            </div>
        </div>

        <div class="status-panel" id="statusPanel">
            ğŸ“ ìœ„ì¹˜ ì¶”ì ì„ ì‹œì‘í•˜ì—¬ ì •í™•í•œ ê¸¸ì°¾ê¸°ë¥¼ ì´ìš©í•˜ì„¸ìš”
        </div>

        <div class="map-container">
            <div id="map"></div>
            <div class="roadview-container" id="roadviewContainer">
                <div id="roadview"></div>
            </div>
        </div>

        <div class="location-info" id="locationInfo" style="display: none;">
            <h4>ğŸ“ í˜„ì¬ ìœ„ì¹˜ ì •ë³´</h4>
            <div class="coordinates" id="coordinatesDisplay"></div>
            <p><strong>ì •í™•ë„:</strong> <span id="accuracyDisplay"></span>m</p>
        </div>

        <div class="building-list">
            <h3>ğŸ¢ ìº í¼ìŠ¤ ê±´ë¬¼ ëª©ë¡</h3>
            <div class="building-grid" id="buildingGrid"></div>
        </div>
    </div>

    <script>
        // ê±´ë¬¼ ë°ì´í„°
        const buildingData = [
            {
                id: 'ê³µí•™1ê´€',
                name: 'ê³µí•™1ê´€',
                description: 'ê³µí•™ê³„ì—´ ê°•ì˜ì‹¤, ì‹¤í—˜ì‹¤',
                image: 'https://placehold.co/80x60/gray/white?text=ê³µí•™1ê´€',
                type: 'building',
                position: { lat: 37.39632767479923, lng: 126.90699348692698 }
            },
            {
                id: 'ìì—°ê³¼í•™ê´€',
                name: 'ìì—°ê³¼í•™ê´€',
                description: 'ë°˜ë ¤ë™ë¬¼ë³´ê±´í•™, ë°˜ë ¤ë™ë¬¼ì‚°ì—…í•™',
                image: 'https://placehold.co/80x60/gray/white?text=ìì—°ê³¼í•™ê´€',
                type: 'building',
                position: { lat: 37.39669466288283, lng: 126.90676716508685 }
            },
            {
                id: 'ì‹í’ˆê³¼í•™ê´€',
                name: 'ì‹í’ˆê³¼í•™ê´€',
                description: 'ì‹í’ˆì˜ì–‘í•™ê³¼, ì¡°ë¦¬ì‹¤ìŠµì‹¤',
                image: 'https://placehold.co/80x60/gray/white?text=ì‹í’ˆê³¼í•™ê´€',
                type: 'building',
                position: { lat: 37.39714809720343, lng: 126.90762208499473 }
            },
            {
                id: 'ë„ì˜ê´€',
                name: 'ë„ì˜ê´€',
                description: 'êµì–‘ ìˆ˜ì—…, ê°•ë‹¹',
                image: 'https://placehold.co/80x60/gray/white?text=ë„ì˜ê´€',
                type: 'building',
                position: { lat: 37.39679932128769, lng: 126.90809683728425 }
            },
            {
                id: 'ê³µí•™2ê´€',
                name: 'ê³µí•™2ê´€',
                description: 'ê³µí•™ê³„ì—´ ì‹¤ìŠµì‹¤, ì—°êµ¬ì‹¤',
                image: 'https://placehold.co/80x60/gray/white?text=ê³µí•™2ê´€',
                type: 'building',
                position: { lat: 37.396789747114205, lng: 126.90737406929797 }
            },
            {
                id: 'ë¬¸í™”1ê´€',
                name: 'ë¬¸í™”1ê´€',
                description: 'ì¸ë¬¸ì‚¬íšŒê³„ì—´ ê°•ì˜ì‹¤',
                image: 'https://placehold.co/80x60/gray/white?text=ë¬¸í™”1ê´€',
                type: 'building',
                position: { lat: 37.39576992475254, lng: 126.90812350405056 }
            },
            {
                id: 'ì—°ê³¡ë¬¸í™”ì„¼í„°',
                name: 'ì—°ê³¡ë¬¸í™”ì„¼í„°',
                description: 'ê¸°ìˆ™ì‚¬, ì»¨ë²¤ì…˜í™€, í‰ìƒêµìœ¡ì›',
                image: 'https://placehold.co/80x60/gray/white?text=ì—°ê³¡ë¬¸í™”ì„¼í„°',
                type: 'building',
                position: { lat: 37.398046192024914, lng: 126.90966512810492 }
            },
            {
                id: 'ì°½ì¡°ê´€',
                name: 'ì°½ì¡°ê´€',
                description: 'í•™ê³¼ ì‚¬ë¬´ì‹¤, ê°•ì˜ì‹¤',
                image: 'https://placehold.co/80x60/gray/white?text=ì°½ì¡°ê´€',
                type: 'building',
                position: { lat: 37.39730791148064, lng: 126.91039726900274 }
            },
            {
                id: 'ìš´ë™ì¥',
                name: 'ìš´ë™ì¥',
                description: 'ì²´ìœ¡í™œë™, í–‰ì‚¬ì¥',
                image: 'https://placehold.co/80x60/gray/white?text=ìš´ë™ì¥',
                type: 'building',
                position: { lat: 37.39673944839101, lng: 126.90932224700094 }
            },
            {
                id: 'ë†êµ¬ì¥',
                name: 'ë†êµ¬ì¥',
                description: 'ì²´ìœ¡í™œë™',
                image: 'https://placehold.co/80x60/gray/white?text=ë†êµ¬ì¥',
                type: 'building',
                position: { lat: 37.39667684947615, lng: 126.90994063692402 }
            },
            {
                id: 'í•™ìƒë³µì§€ì„¼í„°',
                name: 'í•™ìƒë³µì§€ì„¼í„°',
                description: 'í•™ìƒì§€ì› ì‹œì„¤',
                image: 'https://placehold.co/80x60/gray/white?text=í•™ìƒë³µì§€ì„¼í„°',
                type: 'building',
                position: { lat: 37.3962916630711, lng: 126.90994109780426 }
            },
            {
                id: 'ì°½ì˜êµìœ¡ì„¼í„°',
                name: 'ì°½ì˜êµìœ¡ì„¼í„°',
                description: 'í•­ê³µì„œë¹„ìŠ¤ê³¼ í•­ê³µì‹¤ìŠµì‹¤, ì¹´í˜',
                image: 'https://placehold.co/80x60/gray/white?text=ì°½ì˜êµìœ¡ì„¼í„°',
                type: 'building',
                position: { lat: 37.39737971014044, lng: 126.91002449732869 }
            },
            {
                id: 'ë¬¸í™”2ê´€',
                name: 'ë¬¸í™”2ê´€',
                description: 'ë¬¸í™”ì½˜í…ì¸ ê³„ì—´ ê°•ì˜ì‹¤',
                image: 'https://placehold.co/80x60/gray/white?text=ë¬¸í™”2ê´€',
                type: 'building',
                position: { lat: 37.396035307891026, lng: 126.90758674745014 }
            },
            {
                id: 'ëŒ€í•™ë³¸ê´€',
                name: 'ëŒ€í•™ë³¸ê´€',
                description: 'ìœ í†µë¬¼ë¥˜í•™ê³¼, ì´ì¥ì‹¤',
                image: 'https://placehold.co/80x60/gray/white?text=ëŒ€í•™ë³¸ê´€',
                type: 'building',
                position: { lat: 37.397467068076345, lng: 126.90938066144557 }
            },
            {
                id: 'í•™ìˆ ì •ë³´ê´€',
                name: 'í•™ìˆ ì •ë³´ê´€',
                description: 'ë…ì„œì‹¤',
                image: 'https://placehold.co/80x60/gray/white?text=í•™ìˆ ì •ë³´ê´€',
                type: 'building',
                position: { lat: 37.39637467129301, lng: 126.906603807587 }
            }
        ];

        // ì „ì—­ ë³€ìˆ˜
        let map, roadview;
        let currentLocationMarker, destinationMarker;
        let currentPosition = null;
        let selectedBuilding = null;
        let trackingWatchId = null;
        let isTracking = false;
        let buildingMarkers = [];
        let routePolyline = null;

        // ì§€ë„ ì´ˆê¸°í™”
        function initMap() {
            // ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ í™•ì¸
            if (typeof naver === 'undefined' || typeof naver.maps === 'undefined') {
                console.error('ë„¤ì´ë²„ ì§€ë„ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                updateStatus('âŒ ì§€ë„ API ë¡œë“œ ì‹¤íŒ¨. ë„¤ì´ë²„ ì§€ë„ API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                // í…ŒìŠ¤íŠ¸ìš© êµ¬ê¸€ ë§µìœ¼ë¡œ ëŒ€ì²´
                initGoogleMap();
                return;
            }

            const mapOptions = {
                center: new naver.maps.LatLng(37.39661657434427, 126.90772437800818),
                zoom: 17,
                mapTypeControl: true,
                mapTypeControlOptions: {
                    style: naver.maps.MapTypeControlStyle.BUTTON,
                    position: naver.maps.Position.TOP_RIGHT
                },
                zoomControl: true,
                zoomControlOptions: {
                    style: naver.maps.ZoomControlStyle.LARGE,
                    position: naver.maps.Position.TOP_LEFT
                }
            };

            try {
                map = new naver.maps.Map('map', mapOptions);
                
                // ë¡œë“œë·° ì´ˆê¸°í™”
                roadview = new naver.maps.StreetView(document.getElementById('roadview'));

                // ê±´ë¬¼ ë§ˆì»¤ ìƒì„±
                createBuildingMarkers();
                
                // ê±´ë¬¼ ëª©ë¡ ìƒì„±
                createBuildingList();

                updateStatus('âœ… ì§€ë„ê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. ìœ„ì¹˜ ì¶”ì ì„ ì‹œì‘í•´ì£¼ì„¸ìš”.');
            } catch (error) {
                console.error('ì§€ë„ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
                updateStatus('âŒ ì§€ë„ ì´ˆê¸°í™” ì‹¤íŒ¨. ëŒ€ì²´ ì§€ë„ë¥¼ ë¡œë“œí•©ë‹ˆë‹¤.');
                initGoogleMap();
            }
        }

        // êµ¬ê¸€ ë§µìœ¼ë¡œ ëŒ€ì²´ (ë„¤ì´ë²„ ì§€ë„ ì‹¤íŒ¨ ì‹œ)
        function initGoogleMap() {
            document.getElementById('map').innerHTML = `
                <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #667eea 0%, %764ba2 100%); display: flex; align-items: center; justify-content: center; flex-direction: column; color: white; text-align: center; padding: 20px;">
                    <div style="font-size: 48px; margin-bottom: 20px;">ğŸ—ºï¸</div>
                    <h3 style="margin-bottom: 15px;">ì§€ë„ ì„œë¹„ìŠ¤ ì¤€ë¹„ ì¤‘</h3>
                    <p style="margin-bottom: 20px;">ë„¤ì´ë²„ ì§€ë„ API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 10px; font-size: 14px; max-width: 400px;">
                        <p><strong>í•´ê²° ë°©ë²•:</strong></p>
                        <p>1. ë„¤ì´ë²„ í´ë¼ìš°ë“œ í”Œë«í¼ì—ì„œ Maps API í‚¤ ë°œê¸‰</p>
                        <p>2. HTML íŒŒì¼ì˜ YOUR_CLIENT_IDë¥¼ ì‹¤ì œ í‚¤ë¡œ êµì²´</p>
                    </div>
                    <div style="margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <p><strong>ì—°ì„±ëŒ€í•™êµ ìœ„ì¹˜:</strong></p>
                        <p>ìœ„ë„: 37.39661657434427</p>
                        <p>ê²½ë„: 126.90772437800818</p>
                    </div>
                </div>
            `;
            
            // ê¸°ë³¸ ê¸°ëŠ¥ì€ ê³„ì† ì‘ë™í•˜ë„ë¡
            createBuildingList();
            updateStatus('âš ï¸ ì§€ë„ API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤. ê±´ë¬¼ ëª©ë¡ì€ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        }

        // ê±´ë¬¼ ë§ˆì»¤ ìƒì„±
        function createBuildingMarkers() {
            if (!map || typeof naver === 'undefined') {
                console.log('ì§€ë„ ë˜ëŠ” ë„¤ì´ë²„ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•„ ë§ˆì»¤ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            buildingData.forEach(building => {
                try {
                    const position = new naver.maps.LatLng(building.position.lat, building.position.lng);
                    
                    const marker = new naver.maps.Marker({
                        position: position,
                        map: map,
                        title: building.name,
                        icon: {
                            content: `<div style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 8px 12px; border-radius: 20px; font-weight: bold; font-size: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.3); white-space: nowrap;">${building.name}</div>`,
                            anchor: new naver.maps.Point(0, 0)
                        }
                    });

                    // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸
                    naver.maps.Event.addListener(marker, 'click', () => {
                        selectBuilding(building);
                        showBuildingInfo(building, position);
                    });

                    buildingMarkers.push(marker);
                } catch (error) {
                    console.error('ë§ˆì»¤ ìƒì„± ì˜¤ë¥˜:', error);
                }
            });
        }

        // ê±´ë¬¼ ì •ë³´ í‘œì‹œ
        function showBuildingInfo(building, position) {
            const infoWindow = new naver.maps.InfoWindow({
                content: `
                    <div style="padding: 15px; max-width: 200px;">
                        <h4 style="margin: 0 0 10px 0; color: #333;">${building.name}</h4>
                        <p style="margin: 0 0 10px 0; color: #666; font-size: 14px;">${building.description}</p>
                        <button onclick="selectBuilding({id: '${building.id}', name: '${building.name}', position: {lat: ${building.position.lat}, lng: ${building.position.lng}}})" 
                                style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; border: none; padding: 8px 15px; border-radius: 15px; cursor: pointer; font-size: 12px;">
                            ëª©ì ì§€ë¡œ ì„¤ì •
                        </button>
                    </div>
                `
            });

            infoWindow.open(map, position);
        }

        // ê±´ë¬¼ ëª©ë¡ ìƒì„±
        function createBuildingList() {
            const grid = document.getElementById('buildingGrid');
            
            buildingData.forEach(building => {
                const item = document.createElement('div');
                item.className = 'building-item';
                item.innerHTML = `
                    <h4>${building.name}</h4>
                    <p>${building.description}</p>
                `;
                
                item.addEventListener('click', () => {
                    selectBuilding(building);
                    // ì§€ë„ ì¤‘ì‹¬ì„ í•´ë‹¹ ê±´ë¬¼ë¡œ ì´ë™
                    map.setCenter(new naver.maps.LatLng(building.position.lat, building.position.lng));
                    map.setZoom(18);
                });
                
                grid.appendChild(item);
            });
        }

        // ìœ„ì¹˜ ì¶”ì  ì‹œì‘
        function startTracking() {
            if (isTracking) {
                stopTracking();
                return;
            }

            if (!navigator.geolocation) {
                updateStatus('âŒ ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }

            updateStatus('ğŸ“ ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...');

            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 0
            };

            // ì‹¤ì‹œê°„ ìœ„ì¹˜ ì¶”ì 
            trackingWatchId = navigator.geolocation.watchPosition(
                updateCurrentLocation,
                handleLocationError,
                options
            );

            isTracking = true;
            document.getElementById('trackingBtn').textContent = 'â¹ï¸ ì¶”ì  ì¤‘ì§€';
            document.getElementById('trackingBtn').classList.remove('btn-success');
            document.getElementById('trackingBtn').classList.add('btn-secondary');
        }

        // ìœ„ì¹˜ ì¶”ì  ì¤‘ì§€
        function stopTracking() {
            if (trackingWatchId) {
                navigator.geolocation.clearWatch(trackingWatchId);
                trackingWatchId = null;
            }

            isTracking = false;
            document.getElementById('trackingBtn').textContent = 'ğŸ“ ìœ„ì¹˜ ì¶”ì  ì‹œì‘';
            document.getElementById('trackingBtn').classList.remove('btn-secondary');
            document.getElementById('trackingBtn').classList.add('btn-success');
            updateStatus('ìœ„ì¹˜ ì¶”ì ì´ ì¤‘ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // í˜„ì¬ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
        function updateCurrentLocation(position) {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const accuracy = position.coords.accuracy;

            currentPosition = { lat, lng };

            // í˜„ì¬ ìœ„ì¹˜ ë§ˆì»¤ ì—…ë°ì´íŠ¸
            if (currentLocationMarker) {
                currentLocationMarker.setMap(null);
            }

            currentLocationMarker = new naver.maps.Marker({
                position: new naver.maps.LatLng(lat, lng),
                map: map,
                icon: {
                    content: `
                        <div style="width: 20px; height: 20px; background: #4285f4; border: 3px solid white; border-radius: 50%; box-shadow: 0 2px 8px rgba(0,0,0,0.3); position: relative;">
                            <div style="width: 40px; height: 40px; background: rgba(66, 133, 244, 0.2); border-radius: 50%; position: absolute; top: -13px; left: -13px; animation: pulse 2s infinite;"></div>
                        </div>
                        <style>
                            @keyframes pulse {
                                0% { transform: scale(0.8); opacity: 1; }
                                100% { transform: scale(2); opacity: 0; }
                            }
                        </style>
                    `,
                    anchor: new naver.maps.Point(10, 10)
                }
            });

            // ìœ„ì¹˜ ì •ë³´ í‘œì‹œ
            document.getElementById('locationInfo').style.display = 'block';
            document.getElementById('coordinatesDisplay').textContent = `ìœ„ë„: ${lat.toFixed(8)}, ê²½ë„: ${lng.toFixed(8)}`;
            document.getElementById('accuracyDisplay').textContent = accuracy.toFixed(1);

            // ê¸¸ì°¾ê¸° ë²„íŠ¼ í™œì„±í™”
            document.getElementById('routeBtn').disabled = false;

            updateStatus(`âœ… í˜„ì¬ ìœ„ì¹˜ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤. (ì •í™•ë„: ${accuracy.toFixed(1)}m)`);

            // ì§€ë„ ì¤‘ì‹¬ì„ í˜„ì¬ ìœ„ì¹˜ë¡œ ì´ë™ (ì²˜ìŒì—ë§Œ)
            if (!map.hasCenter || map.getCenter().distanceTo(new naver.maps.LatLng(lat, lng)) > 1000) {
                map.setCenter(new naver.maps.LatLng(lat, lng));
                map.setZoom(17);
            }
        }

        // ìœ„ì¹˜ ì˜¤ë¥˜ ì²˜ë¦¬
        function handleLocationError(error) {
            let message = '';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    message = 'âŒ ì‚¬ìš©ìê°€ ìœ„ì¹˜ ì •ë³´ ì œê³µì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤.';
                    break;
                case error.POSITION_UNAVAILABLE:
                    message = 'âŒ ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                    break;
                case error.TIMEOUT:
                    message = 'âŒ ìœ„ì¹˜ ì •ë³´ ìš”ì²­ì´ ì‹œê°„ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    break;
                default:
                    message = 'âŒ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                    break;
            }
            updateStatus(message);
        }

        // ê±´ë¬¼ ê²€ìƒ‰
        function searchBuilding() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) {
                updateStatus('ê²€ìƒ‰í•  ê±´ë¬¼ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const building = buildingData.find(b => 
                b.name.toLowerCase().includes(query.toLowerCase()) ||
                b.description.toLowerCase().includes(query.toLowerCase())
            );

            if (building) {
                selectBuilding(building);
                map.setCenter(new naver.maps.LatLng(building.position.lat, building.position.lng));
                map.setZoom(18);
                updateStatus(`ğŸ¢ "${building.name}"ì„(ë¥¼) ì°¾ì•˜ìŠµë‹ˆë‹¤.`);
            } else {
                updateStatus(`âŒ "${query}"ì— í•´ë‹¹í•˜ëŠ” ê±´ë¬¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
            }
        }

        // ê±´ë¬¼ ì„ íƒ
        function selectBuilding(building) {
            selectedBuilding = building;

            // ëª©ì ì§€ ë§ˆì»¤ ì—…ë°ì´íŠ¸
            if (destinationMarker) {
                destinationMarker.setMap(null);
            }

            destinationMarker = new naver.maps.Marker({
                position: new naver.maps.LatLng(building.position.lat, building.position.lng),
                map: map,
                icon: {
                    content: `
                        <div style="background: linear-gradient(45deg, #f093fb, #f5576c); color: white; padding: 10px 15px; border-radius: 25px; font-weight: bold; font-size: 14px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); white-space: nowrap; position: relative;">
                            ğŸ¯ ${building.name}
                            <div style="position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; border-top: 8px solid #f5576c;"></div>
                        </div>
                    `,
                    anchor: new naver.maps.Point(0, 0)
                }
            });

            updateStatus(`ğŸ¯ ëª©ì ì§€: ${building.name}`);
            
            // ê¸¸ì°¾ê¸° ë²„íŠ¼ í™œì„±í™” (í˜„ì¬ ìœ„ì¹˜ê°€ ìˆëŠ” ê²½ìš°)
            if (currentPosition) {
                document.getElementById('routeBtn').disabled = false;
            }
        }

        // ê¸¸ì°¾ê¸°
        function findRoute() {
            if (!currentPosition || !selectedBuilding) {
                updateStatus('âŒ í˜„ì¬ ìœ„ì¹˜ì™€ ëª©ì ì§€ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }

            updateStatus('ğŸ” ìµœì  ê²½ë¡œë¥¼ ê²€ìƒ‰ ì¤‘...');

            // ê¸°ì¡´ ê²½ë¡œ ì œê±°
            if (routePolyline) {
                routePolyline.setMap(null);
            }

            const start = new naver.maps.LatLng(currentPosition.lat, currentPosition.lng);
            const end = new naver.maps.LatLng(selectedBuilding.position.lat, selectedBuilding.position.lng);

            // Direction API ì‚¬ìš© (ë„ë³´ ê²½ë¡œ)
            naver.maps.Service.route({
                start: start,
                goal: end,
                option: 'trafast' // ì‹¤ì‹œê°„ ë¹ ë¥¸ê¸¸
            }, function(status, response) {
                if (status === naver.maps.Service.Status.ERROR) {
                    // API ì‹¤íŒ¨ ì‹œ ì§ì„  ê²½ë¡œë¡œ ëŒ€ì²´
                    createStraightRoute(start, end);
                    return;
                }

                const route = response.result.route;
                if (route && route.trafast && route.trafast.length > 0) {
                    const path = route.trafast[0].path;
                    const polylinePath = path.map(p => new naver.maps.LatLng(p[1], p[0]));
                    
                    routePolyline = new naver.maps.Polyline({
                        map: map,
                        path: polylinePath,
                        strokeColor: '#4285f4',
                        strokeOpacity: 0.8,
                        strokeWeight: 6,
                        strokeLineCap: 'round',
                        strokeLineJoin: 'round'
                    });

                    // ê²½ë¡œì— ë§ê²Œ ì§€ë„ ë²”ìœ„ ì¡°ì •
                    const bounds = new naver.maps.LatLngBounds();
                    polylinePath.forEach(point => bounds.extend(point));
                    map.fitBounds(bounds, { padding: 50 });

                    const distance = route.trafast[0].summary.distance;
                    const duration = route.trafast[0].summary.duration;
                    
                    updateStatus(`âœ… ê²½ë¡œ ì•ˆë‚´: ê±°ë¦¬ ${(distance/1000).toFixed(2)}km, ì˜ˆìƒ ì‹œê°„ ${Math.ceil(duration/60000)}ë¶„`);
                } else {
                    createStraightRoute(start, end);
                }
            });
        }

        // ì§ì„  ê²½ë¡œ ìƒì„± (API ì‹¤íŒ¨ ì‹œ ëŒ€ì²´)
        function createStraightRoute(start, end) {
            routePolyline = new naver.maps.Polyline({
                map: map,
                path: [start, end],
                strokeColor: '#ff6b6b',
                strokeOpacity: 0.8,
                strokeWeight: 6,
                strokeLineCap: 'round',
                strokeStyle: 'dashed'
            });

            // ì§€ë„ ë²”ìœ„ ì¡°ì •
            const bounds = new naver.maps.LatLngBounds();
            bounds.extend(start);
            bounds.extend(end);
            map.fitBounds(bounds, { padding: 50 });

            const distance = start.distanceTo(end);
            updateStatus(`ğŸ“ ì§ì„  ê±°ë¦¬: ${(distance/1000).toFixed(2)}km (ë„ë³´ ê²½ë¡œ)`);
        }

        // ë¡œë“œë·° í† ê¸€
        function toggleRoadview() {
            const container = document.getElementById('roadviewContainer');
            
            if (container.style.display === 'none' || !container.style.display) {
                if (currentPosition) {
                    // í˜„ì¬ ìœ„ì¹˜ì˜ ë¡œë“œë·° í‘œì‹œ
                    const position = new naver.maps.LatLng(currentPosition.lat, currentPosition.lng);
                    roadview.setPosition(position);
                    roadview.setPov({
                        pan: 0,
                        tilt: 0,
                        fov: 100
                    });
                    container.style.display = 'block';
                    updateStatus('ğŸŒ ë¡œë“œë·°ê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    updateStatus('âŒ í˜„ì¬ ìœ„ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
                }
            } else {
                container.style.display = 'none';
                updateStatus('ë¡œë“œë·°ê°€ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus(message) {
            document.getElementById('statusPanel').textContent = message;
        }

        // Enter í‚¤ ì´ë²¤íŠ¸
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchBuilding();
            }
        });

        // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸ (ë¡œë“œë·° ìœ„ì¹˜ ë³€ê²½)
        naver.maps.Event.addListener(map, 'click', function(e) {
            const container = document.getElementById('roadviewContainer');
            if (container.style.display === 'block') {
                roadview.setPosition(e.coord);
                updateStatus(`ğŸ“ ë¡œë“œë·° ìœ„ì¹˜: ${e.coord.lat().toFixed(6)}, ${e.coord.lng().toFixed(6)}`);
            }
        });

        // GPS ì •í™•ë„ í–¥ìƒì„ ìœ„í•œ ì¶”ê°€ ì˜µì…˜
        function requestHighAccuracyLocation() {
            if (!navigator.geolocation) return;

            navigator.geolocation.getCurrentPosition(
                function(position) {
                    updateCurrentLocation(position);
                    updateStatus('ğŸ¯ ê³ ì •ë°€ ìœ„ì¹˜ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                },
                handleLocationError,
                {
                    enableHighAccuracy: true,
                    timeout: 15000,
                    maximumAge: 0
                }
            );
        }

        // ê±°ë¦¬ ê³„ì‚° í—¬í¼ í•¨ìˆ˜
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371e3; // ì§€êµ¬ ë°˜ì§€ë¦„ (ë¯¸í„°)
            const Ï†1 = lat1 * Math.PI/180;
            const Ï†2 = lat2 * Math.PI/180;
            const Î”Ï† = (lat2-lat1) * Math.PI/180;
            const Î”Î» = (lng2-lng1) * Math.PI/180;

            const a = Math.sin(Î”Ï†/2) * Math.sin(Î”Ï†/2) +
                      Math.cos(Ï†1) * Math.cos(Ï†2) *
                      Math.sin(Î”Î»/2) * Math.sin(Î”Î»/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

            return R * c; // ë¯¸í„° ë‹¨ìœ„ ê±°ë¦¬
        }

        // ê±´ë¬¼ê¹Œì§€ì˜ ê±°ë¦¬ í‘œì‹œ
        function updateDistanceToBuilding() {
            if (!currentPosition || !selectedBuilding) return;

            const distance = calculateDistance(
                currentPosition.lat, currentPosition.lng,
                selectedBuilding.position.lat, selectedBuilding.position.lng
            );

            if (distance < 50) {
                updateStatus(`ğŸ‰ ëª©ì ì§€ "${selectedBuilding.name}"ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤! (${distance.toFixed(0)}m)`);
            } else if (distance < 200) {
                updateStatus(`ğŸš¶â€â™‚ï¸ "${selectedBuilding.name}"ê¹Œì§€ ${distance.toFixed(0)}m ë‚¨ì•˜ìŠµë‹ˆë‹¤.`);
            }
        }

        // ì‹¤ì‹œê°„ ê±°ë¦¬ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ìœ„ì¹˜ ì¶”ì  ê°œì„ 
        function enhancedUpdateCurrentLocation(position) {
            updateCurrentLocation(position);
            updateDistanceToBuilding();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì§€ë„ ì´ˆê¸°í™”
        window.onload = function() {
            console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ, ì§€ë„ ì´ˆê¸°í™” ì‹œì‘...');
            
            // ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ í™•ì¸
            if (typeof naver === 'undefined') {
                console.error('ë„¤ì´ë²„ ì§€ë„ APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                setTimeout(() => {
                    if (typeof naver === 'undefined') {
                        updateStatus('âŒ ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ ì‹¤íŒ¨. API í‚¤ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.');
                        initGoogleMap();
                    } else {
                        initMap();
                    }
                }, 2000);
            } else {
                initMap();
            }
            
            // ìë™ìœ¼ë¡œ ìœ„ì¹˜ ì¶”ì  ì‹œì‘ ì œì•ˆ (3ì´ˆ í›„)
            setTimeout(() => {
                if (confirm('ìœ„ì¹˜ ê¸°ë°˜ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì •í™•í•œ ê¸¸ì°¾ê¸°ë¥¼ ìœ„í•´ ê¶Œì¥ë©ë‹ˆë‹¤.')) {
                    startTracking();
                } else {
                    updateStatus('ìœ„ì¹˜ ì„œë¹„ìŠ¤ ì—†ì´ ì§€ë„ë¥¼ íƒìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                }
            }, 3000);
        };

        // í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ ì§€ë„ í¬ê¸° ì¡°ì •
        window.addEventListener('resize', function() {
            if (map) {
                map.autoResize();
            }
        });

        // ë°°í„°ë¦¬ ì ˆì•½ ëª¨ë“œ (ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì¶”ì  ë¹ˆë„ ì¡°ì ˆ)
        document.addEventListener('visibilitychange', function() {
            if (document.hidden && isTracking) {
                // í˜ì´ì§€ê°€ ë°±ê·¸ë¼ìš´ë“œë¡œ ê°ˆ ë•Œ ì¶”ì  ë¹ˆë„ ê°ì†Œ
                stopTracking();
                setTimeout(() => {
                    if (document.hidden) startTracking();
                }, 5000);
            }
        });

        // ì˜¤í”„ë¼ì¸ ìƒíƒœ ê°ì§€
        window.addEventListener('online', function() {
            updateStatus('âœ… ì¸í„°ë„· ì—°ê²°ì´ ë³µêµ¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
        });

        window.addEventListener('offline', function() {
            updateStatus('âš ï¸ ì¸í„°ë„· ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤. ê¸°ë³¸ ê¸°ëŠ¥ë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        });

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'f':
                        e.preventDefault();
                        document.getElementById('searchInput').focus();
                        break;
                    case 'l':
                        e.preventDefault();
                        startTracking();
                        break;
                    case 'r':
                        e.preventDefault();
                        if (currentPosition && selectedBuilding) {
                            findRoute();
                        }
                        break;
                }
            }
        });

        // ë””ë²„ê·¸ ì •ë³´ (ê°œë°œìš©)
        function showDebugInfo() {
            console.log('í˜„ì¬ ìœ„ì¹˜:', currentPosition);
            console.log('ì„ íƒëœ ê±´ë¬¼:', selectedBuilding);
            console.log('ì¶”ì  ìƒíƒœ:', isTracking);
            console.log('ì§€ë„ ì¤‘ì‹¬:', map.getCenter());
            console.log('ì§€ë„ ì¤Œ:', map.getZoom());
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ ë…¸ì¶œ (HTMLì—ì„œ í˜¸ì¶œí•˜ê¸° ìœ„í•´)
        window.selectBuilding = selectBuilding;
        window.searchBuilding = searchBuilding;
        window.startTracking = startTracking;
        window.findRoute = findRoute;
        window.toggleRoadview = toggleRoadview;
        window.showDebugInfo = showDebugInfo;

    </script>
</body>
</html>