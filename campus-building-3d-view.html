<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—°ì„±ëŒ€í•™êµ ìº í¼ìŠ¤ ê°€ì´ë“œ - 3D ê±´ë¬¼ ë‚´ë¶€</title>
    
    <!-- Three.js ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 768px;
            margin: 0 auto;
            background-color: white;
            min-height: 100vh;
            padding-bottom: 60px;
            position: relative;
        }
        
        header {
            background-color: #c62917;
            color: white;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .header-icons {
            display: flex;
            gap: 16px;
            align-items: center;
        }
        
        .login-button {
            padding: 6px 12px;
            background-color: white;
            color: #c62917;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
        }
        
        /* íƒ­ ë©”ë‰´ */
        .tab-menu {
            display: flex;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 768px;
            margin: 0 auto;
            background-color: white;
            border-top: 1px solid #ddd;
            z-index: 1000;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
        }
        
        .tab-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 0;
            font-size: 12px;
            color: #888;
            text-decoration: none;
            cursor: pointer;
        }
        
        .tab-item.active {
            color: #c62917;
        }
        
        .tab-icon {
            font-size: 22px;
            margin-bottom: 4px;
        }
        
        /* ê±´ë¬¼ ëª©ë¡ */
        .content {
            padding: 16px;
        }
        
        .building-list-container {
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 22px;
            margin-bottom: 16px;
            color: #333;
        }
        
        .building-list {
            list-style: none;
        }
        
        .building-item {
            display: flex;
            padding: 12px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .building-item:hover {
            background-color: #f9f9f9;
        }
        
        .building-image {
            width: 80px;
            height: 60px;
            border-radius: 4px;
            overflow: hidden;
            margin-right: 12px;
            background-color: #f0f0f0;
        }
        
        .building-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .building-info-container {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .building-info {
            flex: 1;
        }
        
        .building-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .building-description {
            font-size: 13px;
            color: #666;
        }
        
        .building-button {
            padding: 8px 12px;
            border-radius: 4px;
            background-color: #e8f4fc;
            color: #0066cc;
            font-size: 14px;
            cursor: pointer;
        }
        
        /* 3D ê±´ë¬¼ ë‚´ë¶€ ë·° */
        #building3dView {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #030812;
            z-index: 2000;
        }
        
        .view-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }
        
        .view-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .close-button {
            font-size: 24px;
            color: white;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .close-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .floor-controls {
            position: absolute;
            left: 16px;
            top: 80px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .floor-button {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .floor-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .floor-button.active {
            background-color: #c62917;
        }
        
        .view-controls {
            position: absolute;
            right: 16px;
            bottom: 16px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .control-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            color: #333;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .room-info {
            position: absolute;
            left: 16px;
            bottom: 16px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 16px;
            border-radius: 8px;
            max-width: 300px;
            display: none;
        }
        
        .room-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .room-description {
            font-size: 14px;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 30;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo" onclick="goToHome()">ì—°ì„±ëŒ€í•™êµ</div>
            <div class="header-icons">
                <a href="#" class="login-button">ë¡œê·¸ì¸</a>
            </div>
        </header>
        
        <div class="content">
            <div class="building-list-container">
                <h1>ê±´ë¬¼ ëª©ë¡</h1>
                <ul class="building-list">
                    <li class="building-item" onclick="show3DBuilding('ê³µí•™1ê´€')">
                        <div class="building-image">
                            <img src="https://via.placeholder.com/80x60" alt="ê³µí•™1ê´€">
                        </div>
                        <div class="building-info-container">
                            <div class="building-info">
                                <div class="building-name">ê³µí•™1ê´€</div>
                                <div class="building-description">ê³µí•™ê³„ì—´ ê°•ì˜ì‹¤, ì‹¤í—˜ì‹¤</div>
                            </div>
                            <div class="building-button">3D ë³´ê¸°</div>
                        </div>
                    </li>
                    <li class="building-item" onclick="show3DBuilding('ìì—°ê³¼í•™ê´€')">
                        <div class="building-image">
                            <img src="https://via.placeholder.com/80x60" alt="ìì—°ê³¼í•™ê´€">
                        </div>
                        <div class="building-info-container">
                            <div class="building-info">
                                <div class="building-name">ìì—°ê³¼í•™ê´€</div>
                                <div class="building-description">ë°˜ë ¤ë™ë¬¼ë³´ê±´í•™ê³¼, ë°˜ë ¤ë™ë¬¼ì‚°ì—…ê³¼</div>
                            </div>
                            <div class="building-button">3D ë³´ê¸°</div>
                        </div>
                    </li>
                    <li class="building-item" onclick="show3DBuilding('ì‹í’ˆê³¼í•™ê´€')">
                        <div class="building-image">
                            <img src="https://via.placeholder.com/80x60" alt="ì‹í’ˆê³¼í•™ê´€">
                        </div>
                        <div class="building-info-container">
                            <div class="building-info">
                                <div class="building-name">ì‹í’ˆê³¼í•™ê´€</div>
                                <div class="building-description">ì‹í’ˆì˜ì–‘í•™ê³¼, ì¡°ë¦¬ì‹¤ìŠµì‹¤</div>
                            </div>
                            <div class="building-button">3D ë³´ê¸°</div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        
        <div class="tab-menu">
            <div class="tab-item active">
                <span class="tab-icon">ğŸ </span>
                <span>í™ˆ</span>
            </div>
            <div class="tab-item">
                <span class="tab-icon">ğŸ«</span>
                <span>ì‹œì„¤</span>
            </div>
            <div class="tab-item">
                <span class="tab-icon">ğŸ’¬</span>
                <span>ì»¤ë®¤ë‹ˆí‹°</span>
            </div>
            <div class="tab-item">
                <span class="tab-icon">ğŸ‘¤</span>
                <span>ë‚´ ì •ë³´</span>
            </div>
            <div class="tab-item">
                <span class="tab-icon">ğŸ””</span>
                <span>ì•Œë¦¼</span>
            </div>
        </div>
    </div>
    
    <!-- 3D ê±´ë¬¼ ë‚´ë¶€ ë·° -->
    <div id="building3dView">
        <div class="view-header">
            <div class="view-title">ê³µí•™1ê´€</div>
            <div class="close-button" onclick="close3DBuilding()">Ã—</div>
        </div>
        
        <div class="floor-controls">
            <div class="floor-button" onclick="changeFloor('4F')">4ì¸µ</div>
            <div class="floor-button" onclick="changeFloor('3F')">3ì¸µ</div>
            <div class="floor-button active" onclick="changeFloor('2F')">2ì¸µ</div>
            <div class="floor-button" onclick="changeFloor('1F')">1ì¸µ</div>
            <div class="floor-button" onclick="changeFloor('B1')">B1</div>
        </div>
        
        <div class="view-controls">
            <div class="control-button" onclick="resetCamera()">ğŸ </div>
            <div class="control-button" onclick="zoomIn()">ğŸ”+</div>
            <div class="control-button" onclick="zoomOut()">ğŸ”-</div>
        </div>
        
        <div class="room-info">
            <div class="room-title">401í˜¸</div>
            <div class="room-description">
                ê°•ì˜ì‹¤ | ìˆ˜ìš©ì¸ì›: 80ëª…<br>
                ì‹œì„¤: ë¹”í”„ë¡œì í„°, ìŒí–¥ì‹œì„¤
            </div>
        </div>
        
        <div class="loading-screen">
            <div class="loading-spinner"></div>
            <div>3D ê±´ë¬¼ ëª¨ë¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
    </div>
    
    <script>
        // Three.js ë³€ìˆ˜
        let scene, camera, renderer, controls;
        let buildingModel;
        let currentFloor = '2F';
        let currentBuilding = '';
        let floorModels = {};
        let roomObjects = {};
        let isLoaded = false;
        
        // ì´ˆê¸°í™” í•¨ìˆ˜
        function init3DEnvironment() {
            // ì´ë¯¸ ì´ˆê¸°í™”ë˜ì—ˆìœ¼ë©´ ë¦¬í„´
            if (scene) return;
            
            // ì”¬ ìƒì„±
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x030812);
            
            // ì¹´ë©”ë¼ ì„¤ì •
            camera = new THREE.PerspectiveCamera(
                60, 
                window.innerWidth / window.innerHeight, 
                0.1, 
                1000
            );
            camera.position.set(0, 10, 20);
            
            // ë Œë”ëŸ¬ ì„¤ì •
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            document.getElementById('building3dView').appendChild(renderer.domElement);
            
            // ì»¨íŠ¸ë¡¤ ì„¤ì •
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.screenSpacePanning = false;
            controls.minDistance = 5;
            controls.maxDistance = 50;
            controls.maxPolarAngle = Math.PI / 2;
            
            // ì¡°ëª… ì„¤ì •
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(0, 10, 10);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // ë°”ë‹¥ ê·¸ë¦¬ë“œ ì¶”ê°€
            const gridHelper = new THREE.GridHelper(100, 100, 0x404040, 0x404040);
            scene.add(gridHelper);
            
            // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸
            window.addEventListener('resize', onWindowResize);
            
            // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„ ì‹œì‘
            animate();
        }
        
        // 3D ëª¨ë¸ ë¡œë“œ í•¨ìˆ˜
        function loadBuildingModel(buildingId) {
            // ì‹¤ì œë¡œëŠ” ì—¬ê¸°ì„œ GLTFLoaderë¥¼ ì‚¬ìš©í•˜ì—¬ ëª¨ë¸ íŒŒì¼ì„ ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤
            // ì´ ì˜ˆì œì—ì„œëŠ” ê°„ë‹¨í•œ 3D ëª¨ë¸ì„ í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤
            
            // ì´ì „ ëª¨ë¸ ì œê±°
            if (buildingModel) {
                scene.remove(buildingModel);
            }
            
            // ë¹Œë”© ì»¨í…Œì´ë„ˆ ìƒì„±
            buildingModel = new THREE.Group();
            scene.add(buildingModel);
            
            // ê° ì¸µë³„ ëª¨ë¸ ìƒì„±
            floorModels = {
                'B1': createFloorModel('B1', -5),
                '1F': createFloorModel('1F', 0),
                '2F': createFloorModel('2F', 5),
                '3F': createFloorModel('3F', 10),
                '4F': createFloorModel('4F', 15)
            };
            
            // ì´ˆê¸° ì¸µ í‘œì‹œ
            changeFloor(currentFloor);
            
            // ë¡œë”© í™”ë©´ ìˆ¨ê¸°ê¸°
            setTimeout(() => {
                document.querySelector('.loading-screen').style.display = 'none';
                isLoaded = true;
            }, 1500);
        }
        
        // ì¸µë³„ ëª¨ë¸ ìƒì„± í•¨ìˆ˜
        function createFloorModel(floorId, height) {
            const floor = new THREE.Group();
            floor.position.y = height;
            buildingModel.add(floor);
            
            // ë°”ë‹¥ ìƒì„±
            const floorGeometry = new THREE.BoxGeometry(30, 0.5, 20);
            const floorMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xeeeeee,
                roughness: 0.8
            });
            const floorMesh = new THREE.Mesh(floorGeometry, floorMaterial);
            floorMesh.position.y = -0.25;
            floorMesh.receiveShadow = true;
            floor.add(floorMesh);
            
            // ê° ì¸µì˜ ë£¸ ë°°ì¹˜ ìƒì„±
            if (floorId === '1F') {
                createRoom(floor, '101', -12, 0, -6, 6, 4, 8, 0xff9966);
                createRoom(floor, '102', -5, 0, -6, 6, 4, 8, 0xffcc99);
                createRoom(floor, '103', 2, 0, -6, 6, 4, 8, 0xffccaa);
                createRoom(floor, '104', 9, 0, -6, 6, 4, 8, 0xffddbb);
                createRoom(floor, 'í™”ì¥ì‹¤', 0, 0, 6, 10, 4, 8, 0x99ccff);
                createRoom(floor, 'ê³„ë‹¨', -12, 0, 6, 6, 4, 8, 0xcccccc);
                createRoom(floor, 'ì—˜ë¦¬ë² ì´í„°', -5, 0, 6, 4, 4, 8, 0xaaaaaa);
            } else if (floorId === '2F') {
                createRoom(floor, '201', -12, 0, -6, 8, 4, 8, 0xcc99cc);
                createRoom(floor, '202', -3, 0, -6, 8, 4, 8, 0xdd88dd);
                createRoom(floor, '203', 6, 0, -6, 8, 4, 8, 0xee77ee);
                createRoom(floor, 'í™”ì¥ì‹¤', 0, 0, 6, 10, 4, 8, 0x99ccff);
                createRoom(floor, 'ê³„ë‹¨', -12, 0, 6, 6, 4, 8, 0xcccccc);
                createRoom(floor, 'ì—˜ë¦¬ë² ì´í„°', -5, 0, 6, 4, 4, 8, 0xaaaaaa);
            } else if (floorId === '3F') {
                createRoom(floor, '301', -10, 0, -6, 12, 4, 8, 0x99ff99);
                createRoom(floor, '302', 4, 0, -6, 10, 4, 8, 0x88ff88);
                createRoom(floor, '304', 0, 0, 6, 12, 4, 8, 0xaaffaa);
                createRoom(floor, 'ê³„ë‹¨', -12, 0, 6, 6, 4, 8, 0xcccccc);
                createRoom(floor, 'ì—˜ë¦¬ë² ì´í„°', -5, 0, 6, 4, 4, 8, 0xaaaaaa);
            } else if (floorId === '4F') {
                createRoom(floor, '401', -10, 0, -6, 12, 4, 8, 0xff6666, true);
                createRoom(floor, '402', 4, 0, -6, 10, 4, 8, 0xee5555);
                createRoom(floor, '404', 0, 0, 6, 12, 4, 8, 0xdd4444);
                createRoom(floor, 'ê³„ë‹¨', -12, 0, 6, 6, 4, 8, 0xcccccc);
                createRoom(floor, 'ì—˜ë¦¬ë² ì´í„°', -5, 0, 6, 4, 4, 8, 0xaaaaaa);
            } else if (floorId === 'B1') {
                createRoom(floor, 'B101', -10, 0, -6, 12, 4, 8, 0x6699cc);
                createRoom(floor, 'B102', 4, 0, -6, 10, 4, 8, 0x5588bb);
                createRoom(floor, 'B103', 0, 0, 6, 12, 4, 8, 0x4477aa);
                createRoom(floor, 'ê³„ë‹¨', -12, 0, 6, 6, 4, 8, 0xcccccc);
                createRoom(floor, 'ì—˜ë¦¬ë² ì´í„°', -5, 0, 6, 4, 4, 8, 0xaaaaaa);
            }
            
            // ë³µë„ ìƒì„±
            const corridorGeometry = new THREE.BoxGeometry(30, 0.1, 4);
            const corridorMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xdddddd,
                roughness: 0.9
            });
            const corridorMesh = new THREE.Mesh(corridorGeometry, corridorMaterial);
            corridorMesh.position.y = 0.3;
            floor.add(corridorMesh);
            
            // ì¸µ ìˆ¨ê¸°ê¸°
            floor.visible = false;
            
            return floor;
        }
        
        // ê°•ì˜ì‹¤ ìƒì„± í•¨ìˆ˜
        function createRoom(parent, roomId, x, y, z, width, height, depth, color, isHighlighted = false) {
            const roomGroup = new THREE.Group();
            roomGroup.position.set(x, y, z);
            parent.add(roomGroup);
            
            // ë£¸ ë³¸ì²´ ìƒì„±
            const roomGeometry = new THREE.BoxGeometry(width, height, depth);
            const roomMaterial = new THREE.MeshStandardMaterial({ 
                color: color,
                transparent: true,
                opacity: 0.8,
                roughness: 0.7
            });
            
            const roomMesh = new THREE.Mesh(roomGeometry, roomMaterial);
            roomMesh.position.y = height/2;
            roomMesh.castShadow = true;
            roomMesh.receiveShadow = true;
            roomGroup.add(roomMesh);
            
            // ê°•ì¡° íš¨ê³¼ (í•˜ì´ë¼ì´íŠ¸ëœ ê²½ìš°)
            if (isHighlighted) {
                const highlightMaterial = new THREE.MeshBasicMaterial({ 
                    color: 0xffffff, 
                    wireframe: true 
                });
                
                const highlightMesh = new THREE.Mesh(roomGeometry, highlightMaterial);
                highlightMesh.position.y = height/2;
                highlightMesh.scale.set(1.01, 1.01, 1.01);
                roomGroup.add(highlightMesh);
                
                // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
                const pulseAnimation = () => {
                    const scale = 1 + 0.02 * Math.sin(Date.now() * 0.003);
                    highlightMesh.scale.set(scale, scale, scale);
                    roomMaterial.emissive.setRGB(0.1, 0.1, 0.1);
                    roomMaterial.emissiveIntensity = 0.5 + 0.5 * Math.sin(Date.now() * 0.003);
                };
                
                roomGroup.pulseAnimation = pulseAnimation;
            }
            
            // ë¼ë²¨ ìƒì„±
            const canvas = document.createElement('canvas');
            canvas.width = 256;
            canvas.height = 128;
            const context = canvas.getContext('2d');
            context.fillStyle = '#ffffff';
            context.font = 'Bold 40px Arial';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.fillText(roomId, 128, 64);
            
            const labelTexture = new THREE.CanvasTexture(canvas);
            const labelMaterial = new THREE.MeshBasicMaterial({ 
                map: labelTexture,
                transparent: true,
                side: THREE.DoubleSide
            });
            
            const labelGeometry = new THREE.PlaneGeometry(3, 1.5);
            const labelMesh = new THREE.Mesh(labelGeometry, labelMaterial);
            labelMesh.position.set(0, height/2, depth/2 + 0.1);
            labelMesh.rotation.y = Math.PI;
            roomGroup.add(labelMesh);
            
            // í´ë¦­ ê°€ëŠ¥í•œ ê°ì²´ë¡œ ë“±ë¡
            roomObjects[roomId] = {
                mesh: roomMesh,
                group: roomGroup,
                info: {
                    id: roomId,
                    name: roomId,
                    type: roomId.includes('ê³„ë‹¨') ? 'ê³„ë‹¨' : 
                          roomId.includes('í™”ì¥ì‹¤') ? 'í™”ì¥ì‹¤' : 
                          roomId.includes('ì—˜ë¦¬ë² ì´í„°') ? 'ì—˜ë¦¬ë² ì´í„°' : 'ê°•ì˜ì‹¤',
                    capacity: Math.floor(Math.random() * 60) + 20,
                    facilities: 'ë¹”í”„ë¡œì í„°, ìŒí–¥ì‹œì„¤'
                }
            };
            
            return roomGroup;
        }
        
        // ì¸µ ë³€ê²½ í•¨ìˆ˜
        function changeFloor(floorId) {
            // ëª¨ë“  ì¸µ ìˆ¨ê¸°ê¸°
            Object.values(floorModels).forEach(floor => {
                floor.visible = false;
            });
            
            // ì„ íƒëœ ì¸µ í‘œì‹œ
            if (floorModels[floorId]) {
                floorModels[floorId].visible = true;
                currentFloor = floorId;
                
                // ì¸µ ë²„íŠ¼ í™œì„±í™” ìƒíƒœ ë³€ê²½
                document.querySelectorAll('.floor-button').forEach(button => {
                    button.classList.remove('active');
                });
                
                document.querySelectorAll('.floor-button').forEach(button => {
                    if (button.textContent.includes(floorId.replace('F', 'ì¸µ').replace('B1', 'B1'))) {
                        button.classList.add('active');
                    }
                });
                
                // ì¹´ë©”ë¼ ìœ„ì¹˜ ì¡°ì •
                const yPosition = {
                    'B1': -5,
                    '1F': 0,
                    '2F': 5,
                    '3F': 10,
                    '4F': 15
                }[floorId];
                
                // ì¹´ë©”ë¼ ìœ„ì¹˜ ì• ë‹ˆë©”ì´ì…˜
                const targetPosition = new THREE.Vector3(0, yPosition + 10, 20);
                animateCamera(targetPosition);
            }
        }
        
        // ì¹´ë©”ë¼ ì• ë‹ˆë©”ì´ì…˜ í•¨ìˆ˜
        function animateCamera(targetPosition) {
            const startPosition = camera.position.clone();
            const duration = 1000; // 1ì´ˆ
            const startTime = Date.now();
            
            function updateCamera() {
                const elapsed = Date.now() - startTime;
                let progress = elapsed / duration;
                
                if (progress >= 1) {
                    camera.position.copy(targetPosition);
                    controls.update();
                    return;
                }
                
                // ì´ì§• í•¨ìˆ˜ ì ìš©
                progress = easeInOutCubic(progress);
                
                // ì¹´ë©”ë¼ ìœ„ì¹˜ ë³´ê°„
                camera.position.lerpVectors(startPosition, targetPosition, progress);
                controls.update();
                
                requestAnimationFrame(updateCamera);
            }
            
            updateCamera();
        }
        
        // ì´ì§• í•¨ìˆ˜
        function easeInOutCubic(t) {
            return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
        }
        
        // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ëŸ¬
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // ì• ë‹ˆë©”ì´ì…˜ ë£¨í”„
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            
            // ê°•ì¡°ëœ ê°ì²´ ì• ë‹ˆë©”ì´ì…˜ ì—…ë°ì´íŠ¸
            Object.values(roomObjects).forEach(room => {
                if (room.group.pulseAnimation) {
                    room.group.pulseAnimation();
                }
            });
            
            renderer.render(scene, camera);
        }
        
        // ë ˆì´ìºìŠ¤íŒ…ìœ¼ë¡œ ê°ì²´ í´ë¦­ ê°ì§€
        function initRaycaster() {
            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2();
            
            window.addEventListener('click', (event) => {
                if (!isLoaded) return;
                
                // ë§ˆìš°ìŠ¤ ì¢Œí‘œ ê³„ì‚°
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
                
                // ë ˆì´ìºìŠ¤íŒ…
                raycaster.setFromCamera(mouse, camera);
                
                // í˜„ì¬ í‘œì‹œëœ ì¸µì˜ ê°ì²´ë§Œ ê²€ì‚¬
                const objects = Object.values(roomObjects)
                    .filter(obj => obj.group.parent && obj.group.parent.visible)
                    .map(obj => obj.mesh);
                
                const intersects = raycaster.intersectObjects(objects);
                
                if (intersects.length > 0) {
                    // í´ë¦­ëœ ê°ì²´ ì°¾ê¸°
                    const clickedMesh = intersects[0].object;
                    const clickedRoomId = Object.keys(roomObjects).find(
                        id => roomObjects[id].mesh === clickedMesh
                    );
                    
                    if (clickedRoomId) {
                        showRoomInfo(clickedRoomId);
                    }
                } else {
                    // ë°°ê²½ í´ë¦­ ì‹œ ë£¸ ì •ë³´ ìˆ¨ê¸°ê¸°
                    document.querySelector('.room-info').style.display = 'none';
                }
            });
        }
        
        // ë£¸ ì •ë³´ í‘œì‹œ í•¨ìˆ˜
        function showRoomInfo(roomId) {
            const roomInfo = roomObjects[roomId].info;
            const infoElement = document.querySelector('.room-info');
            
            infoElement.querySelector('.room-title').textContent = roomInfo.name;
            
            let descriptionHTML = '';
            if (roomInfo.type === 'ê°•ì˜ì‹¤') {
                descriptionHTML = `
                    ${roomInfo.type} | ìˆ˜ìš©ì¸ì›: ${roomInfo.capacity}ëª…<br>
                    ì‹œì„¤: ${roomInfo.facilities}
                `;
            } else {
                descriptionHTML = `${roomInfo.type}`;
            }
            
            infoElement.querySelector('.room-description').innerHTML = descriptionHTML;
            infoElement.style.display = 'block';
        }
        
        // ì¹´ë©”ë¼ ë¦¬ì…‹
        function resetCamera() {
            const yPosition = {
                'B1': -5,
                '1F': 0,
                '2F': 5,
                '3F': 10,
                '4F': 15
            }[currentFloor];
            
            const targetPosition = new THREE.Vector3(0, yPosition + 10, 20);
            animateCamera(targetPosition);
            
            controls.target.set(0, yPosition, 0);
        }
        
        // ì¤Œ ì¸
        function zoomIn() {
            const zoomFactor = 0.8;
            camera.position.lerp(controls.target, 1 - zoomFactor);
            controls.update();
        }
        
        // ì¤Œ ì•„ì›ƒ
        function zoomOut() {
            const zoomFactor = 1.2;
            const direction = new THREE.Vector3().subVectors(
                camera.position, controls.target
            ).normalize();
            
            const distance = camera.position.distanceTo(controls.target);
            camera.position.copy(controls.target).add(
                direction.multiplyScalar(distance * zoomFactor)
            );
            
            controls.update();
        }
        
        // 3D ê±´ë¬¼ ë·° í‘œì‹œ
        function show3DBuilding(buildingId) {
            currentBuilding = buildingId;
            document.getElementById('building3dView').style.display = 'block';
            document.querySelector('.view-title').textContent = buildingId;
            document.querySelector('.loading-screen').style.display = 'flex';
            
            // 3D í™˜ê²½ ì´ˆê¸°í™”
            init3DEnvironment();
            
            // ë ˆì´ìºìŠ¤í„° ì´ˆê¸°í™” (í•œ ë²ˆë§Œ)
            if (!window.raycasterInitialized) {
                initRaycaster();
                window.raycasterInitialized = true;
            }
            
            // ëª¨ë¸ ë¡œë“œ
            loadBuildingModel(buildingId);
            
            // ì¸µ ë²„íŠ¼ ì´ˆê¸° ì„¤ì •
            currentFloor = '2F';
            document.querySelectorAll('.floor-button').forEach(button => {
                button.classList.remove('active');
                if (button.textContent.includes('2ì¸µ')) {
                    button.classList.add('active');
                }
            });
        }
        
        // 3D ê±´ë¬¼ ë·° ë‹«ê¸°
        function close3DBuilding() {
            document.getElementById('building3dView').style.display = 'none';
        }
        
        // í™ˆìœ¼ë¡œ ì´ë™
        function goToHome() {
            // í™ˆ í˜ì´ì§€ë¡œ ì´ë™ ë¡œì§
            alert('í™ˆìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
        }
    </script>
</body>
</html>