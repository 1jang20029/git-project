<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>연성대학교 캠퍼스 가이드 - 3D 건물 내부</title>
    
    <!-- Three.js 라이브러리 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 768px;
            margin: 0 auto;
            background-color: white;
            min-height: 100vh;
            padding-bottom: 60px;
            position: relative;
        }
        
        header {
            background-color: #c62917;
            color: white;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .header-icons {
            display: flex;
            gap: 16px;
            align-items: center;
        }
        
        .login-button {
            padding: 6px 12px;
            background-color: white;
            color: #c62917;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
        }
        
        /* 탭 메뉴 */
        .tab-menu {
            display: flex;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 768px;
            margin: 0 auto;
            background-color: white;
            border-top: 1px solid #ddd;
            z-index: 1000;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.05);
        }
        
        .tab-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 0;
            font-size: 12px;
            color: #888;
            text-decoration: none;
            cursor: pointer;
        }
        
        .tab-item.active {
            color: #c62917;
        }
        
        .tab-icon {
            font-size: 22px;
            margin-bottom: 4px;
        }
        
        /* 건물 목록 */
        .content {
            padding: 16px;
        }
        
        .building-list-container {
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 22px;
            margin-bottom: 16px;
            color: #333;
        }
        
        .building-list {
            list-style: none;
        }
        
        .building-item {
            display: flex;
            padding: 12px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .building-item:hover {
            background-color: #f9f9f9;
        }
        
        .building-image {
            width: 80px;
            height: 60px;
            border-radius: 4px;
            overflow: hidden;
            margin-right: 12px;
            background-color: #f0f0f0;
        }
        
        .building-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .building-info-container {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .building-info {
            flex: 1;
        }
        
        .building-name {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .building-description {
            font-size: 13px;
            color: #666;
        }
        
        .building-button {
            padding: 8px 12px;
            border-radius: 4px;
            background-color: #e8f4fc;
            color: #0066cc;
            font-size: 14px;
            cursor: pointer;
        }
        
        /* 3D 건물 내부 뷰 */
        #building3dView {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #030812;
            z-index: 2000;
        }
        
        .view-header {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }
        
        .view-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .close-button {
            font-size: 24px;
            color: white;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .close-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .floor-controls {
            position: absolute;
            left: 16px;
            top: 80px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .floor-button {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .floor-button:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .floor-button.active {
            background-color: #c62917;
        }
        
        .view-controls {
            position: absolute;
            right: 16px;
            bottom: 16px;
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .control-button {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.9);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            color: #333;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .room-info {
            position: absolute;
            left: 16px;
            bottom: 16px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 16px;
            border-radius: 8px;
            max-width: 300px;
            display: none;
        }
        
        .room-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .room-description {
            font-size: 14px;
            line-height: 1.5;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 30;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo" onclick="goToHome()">연성대학교</div>
            <div class="header-icons">
                <a href="#" class="login-button">로그인</a>
            </div>
        </header>
        
        <div class="content">
            <div class="building-list-container">
                <h1>건물 목록</h1>
                <ul class="building-list">
                    <li class="building-item" onclick="show3DBuilding('공학1관')">
                        <div class="building-image">
                            <img src="https://via.placeholder.com/80x60" alt="공학1관">
                        </div>
                        <div class="building-info-container">
                            <div class="building-info">
                                <div class="building-name">공학1관</div>
                                <div class="building-description">공학계열 강의실, 실험실</div>
                            </div>
                            <div class="building-button">3D 보기</div>
                        </div>
                    </li>
                    <li class="building-item" onclick="show3DBuilding('자연과학관')">
                        <div class="building-image">
                            <img src="https://via.placeholder.com/80x60" alt="자연과학관">
                        </div>
                        <div class="building-info-container">
                            <div class="building-info">
                                <div class="building-name">자연과학관</div>
                                <div class="building-description">반려동물보건학과, 반려동물산업과</div>
                            </div>
                            <div class="building-button">3D 보기</div>
                        </div>
                    </li>
                    <li class="building-item" onclick="show3DBuilding('식품과학관')">
                        <div class="building-image">
                            <img src="https://via.placeholder.com/80x60" alt="식품과학관">
                        </div>
                        <div class="building-info-container">
                            <div class="building-info">
                                <div class="building-name">식품과학관</div>
                                <div class="building-description">식품영양학과, 조리실습실</div>
                            </div>
                            <div class="building-button">3D 보기</div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        
        <div class="tab-menu">
            <div class="tab-item active">
                <span class="tab-icon">🏠</span>
                <span>홈</span>
            </div>
            <div class="tab-item">
                <span class="tab-icon">🏫</span>
                <span>시설</span>
            </div>
            <div class="tab-item">
                <span class="tab-icon">💬</span>
                <span>커뮤니티</span>
            </div>
            <div class="tab-item">
                <span class="tab-icon">👤</span>
                <span>내 정보</span>
            </div>
            <div class="tab-item">
                <span class="tab-icon">🔔</span>
                <span>알림</span>
            </div>
        </div>
    </div>
    
    <!-- 3D 건물 내부 뷰 -->
    <div id="building3dView">
        <div class="view-header">
            <div class="view-title">공학1관</div>
            <div class="close-button" onclick="close3DBuilding()">×</div>
        </div>
        
        <div class="floor-controls">
            <div class="floor-button" onclick="changeFloor('4F')">4층</div>
            <div class="floor-button" onclick="changeFloor('3F')">3층</div>
            <div class="floor-button active" onclick="changeFloor('2F')">2층</div>
            <div class="floor-button" onclick="changeFloor('1F')">1층</div>
            <div class="floor-button" onclick="changeFloor('B1')">B1</div>
        </div>
        
        <div class="view-controls">
            <div class="control-button" onclick="resetCamera()">🏠</div>
            <div class="control-button" onclick="zoomIn()">🔍+</div>
            <div class="control-button" onclick="zoomOut()">🔍-</div>
        </div>
        
        <div class="room-info">
            <div class="room-title">401호</div>
            <div class="room-description">
                강의실 | 수용인원: 80명<br>
                시설: 빔프로젝터, 음향시설
            </div>
        </div>
        
        <div class="loading-screen">
            <div class="loading-spinner"></div>
            <div>3D 건물 모델을 불러오는 중...</div>
        </div>
    </div>
    
    <script>
        // Three.js 변수
        let scene, camera, renderer, controls;
        let buildingModel;
        let currentFloor = '2F';
        let currentBuilding = '';
        let floorModels = {};
        let roomObjects = {};
        let isLoaded = false;
        
        // 초기화 함수
        function init3DEnvironment() {
            // 이미 초기화되었으면 리턴
            if (scene) return;
            
            // 씬 생성
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x030812);
            
            // 카메라 설정
            camera = new THREE.PerspectiveCamera(
                60, 
                window.innerWidth / window.innerHeight, 
                0.1, 
                1000
            );
            camera.position.set(0, 10, 20);
            
            // 렌더러 설정
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.shadowMap.enabled = true;
            document.getElementById('building3dView').appendChild(renderer.domElement);
            
            // 컨트롤 설정
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.screenSpacePanning = false;
            controls.minDistance = 5;
            controls.maxDistance = 50;
            controls.maxPolarAngle = Math.PI / 2;
            
            // 조명 설정
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(0, 10, 10);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // 바닥 그리드 추가
            const gridHelper = new THREE.GridHelper(100, 100, 0x404040, 0x404040);
            scene.add(gridHelper);
            
            // 윈도우 리사이즈 이벤트
            window.addEventListener('resize', onWindowResize);
            
            // 애니메이션 루프 시작
            animate();
        }
        
        // 3D 모델 로드 함수
        function loadBuildingModel(buildingId) {
            // 실제로는 여기서 GLTFLoader를 사용하여 모델 파일을 로드해야 합니다
            // 이 예제에서는 간단한 3D 모델을 프로그래밍 방식으로 생성합니다
            
            // 이전 모델 제거
            if (buildingModel) {
                scene.remove(buildingModel);
            }
            
            // 빌딩 컨테이너 생성
            buildingModel = new THREE.Group();
            scene.add(buildingModel);
            
            // 각 층별 모델 생성
            floorModels = {
                'B1': createFloorModel('B1', -5),
                '1F': createFloorModel('1F', 0),
                '2F': createFloorModel('2F', 5),
                '3F': createFloorModel('3F', 10),
                '4F': createFloorModel('4F', 15)
            };
            
            // 초기 층 표시
            changeFloor(currentFloor);
            
            // 로딩 화면 숨기기
            setTimeout(() => {
                document.querySelector('.loading-screen').style.display = 'none';
                isLoaded = true;
            }, 1500);
        }
        
        // 층별 모델 생성 함수
        function createFloorModel(floorId, height) {
            const floor = new THREE.Group();
            floor.position.y = height;
            buildingModel.add(floor);
            
            // 바닥 생성
            const floorGeometry = new THREE.BoxGeometry(30, 0.5, 20);
            const floorMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xeeeeee,
                roughness: 0.8
            });
            const floorMesh = new THREE.Mesh(floorGeometry, floorMaterial);
            floorMesh.position.y = -0.25;
            floorMesh.receiveShadow = true;
            floor.add(floorMesh);
            
            // 각 층의 룸 배치 생성
            if (floorId === '1F') {
                createRoom(floor, '101', -12, 0, -6, 6, 4, 8, 0xff9966);
                createRoom(floor, '102', -5, 0, -6, 6, 4, 8, 0xffcc99);
                createRoom(floor, '103', 2, 0, -6, 6, 4, 8, 0xffccaa);
                createRoom(floor, '104', 9, 0, -6, 6, 4, 8, 0xffddbb);
                createRoom(floor, '화장실', 0, 0, 6, 10, 4, 8, 0x99ccff);
                createRoom(floor, '계단', -12, 0, 6, 6, 4, 8, 0xcccccc);
                createRoom(floor, '엘리베이터', -5, 0, 6, 4, 4, 8, 0xaaaaaa);
            } else if (floorId === '2F') {
                createRoom(floor, '201', -12, 0, -6, 8, 4, 8, 0xcc99cc);
                createRoom(floor, '202', -3, 0, -6, 8, 4, 8, 0xdd88dd);
                createRoom(floor, '203', 6, 0, -6, 8, 4, 8, 0xee77ee);
                createRoom(floor, '화장실', 0, 0, 6, 10, 4, 8, 0x99ccff);
                createRoom(floor, '계단', -12, 0, 6, 6, 4, 8, 0xcccccc);
                createRoom(floor, '엘리베이터', -5, 0, 6, 4, 4, 8, 0xaaaaaa);
            } else if (floorId === '3F') {
                createRoom(floor, '301', -10, 0, -6, 12, 4, 8, 0x99ff99);
                createRoom(floor, '302', 4, 0, -6, 10, 4, 8, 0x88ff88);
                createRoom(floor, '304', 0, 0, 6, 12, 4, 8, 0xaaffaa);
                createRoom(floor, '계단', -12, 0, 6, 6, 4, 8, 0xcccccc);
                createRoom(floor, '엘리베이터', -5, 0, 6, 4, 4, 8, 0xaaaaaa);
            } else if (floorId === '4F') {
                createRoom(floor, '401', -10, 0, -6, 12, 4, 8, 0xff6666, true);
                createRoom(floor, '402', 4, 0, -6, 10, 4, 8, 0xee5555);
                createRoom(floor, '404', 0, 0, 6, 12, 4, 8, 0xdd4444);
                createRoom(floor, '계단', -12, 0, 6, 6, 4, 8, 0xcccccc);
                createRoom(floor, '엘리베이터', -5, 0, 6, 4, 4, 8, 0xaaaaaa);
            } else if (floorId === 'B1') {
                createRoom(floor, 'B101', -10, 0, -6, 12, 4, 8, 0x6699cc);
                createRoom(floor, 'B102', 4, 0, -6, 10, 4, 8, 0x5588bb);
                createRoom(floor, 'B103', 0, 0, 6, 12, 4, 8, 0x4477aa);
                createRoom(floor, '계단', -12, 0, 6, 6, 4, 8, 0xcccccc);
                createRoom(floor, '엘리베이터', -5, 0, 6, 4, 4, 8, 0xaaaaaa);
            }
            
            // 복도 생성
            const corridorGeometry = new THREE.BoxGeometry(30, 0.1, 4);
            const corridorMaterial = new THREE.MeshStandardMaterial({ 
                color: 0xdddddd,
                roughness: 0.9
            });
            const corridorMesh = new THREE.Mesh(corridorGeometry, corridorMaterial);
            corridorMesh.position.y = 0.3;
            floor.add(corridorMesh);
            
            // 층 숨기기
            floor.visible = false;
            
            return floor;
        }
        
        // 강의실 생성 함수
        function createRoom(parent, roomId, x, y, z, width, height, depth, color, isHighlighted = false) {
            const roomGroup = new THREE.Group();
            roomGroup.position.set(x, y, z);
            parent.add(roomGroup);
            
            // 룸 본체 생성
            const roomGeometry = new THREE.BoxGeometry(width, height, depth);
            const roomMaterial = new THREE.MeshStandardMaterial({ 
                color: color,
                transparent: true,
                opacity: 0.8,
                roughness: 0.7
            });
            
            const roomMesh = new THREE.Mesh(roomGeometry, roomMaterial);
            roomMesh.position.y = height/2;
            roomMesh.castShadow = true;
            roomMesh.receiveShadow = true;
            roomGroup.add(roomMesh);
            
            // 강조 효과 (하이라이트된 경우)
            if (isHighlighted) {
                const highlightMaterial = new THREE.MeshBasicMaterial({ 
                    color: 0xffffff, 
                    wireframe: true 
                });
                
                const highlightMesh = new THREE.Mesh(roomGeometry, highlightMaterial);
                highlightMesh.position.y = height/2;
                highlightMesh.scale.set(1.01, 1.01, 1.01);
                roomGroup.add(highlightMesh);
                
                // 애니메이션 효과
                const pulseAnimation = () => {
                    const scale = 1 + 0.02 * Math.sin(Date.now() * 0.003);
                    highlightMesh.scale.set(scale, scale, scale);
                    roomMaterial.emissive.setRGB(0.1, 0.1, 0.1);
                    roomMaterial.emissiveIntensity = 0.5 + 0.5 * Math.sin(Date.now() * 0.003);
                };
                
                roomGroup.pulseAnimation = pulseAnimation;
            }
            
            // 라벨 생성
            const canvas = document.createElement('canvas');
            canvas.width = 256;
            canvas.height = 128;
            const context = canvas.getContext('2d');
            context.fillStyle = '#ffffff';
            context.font = 'Bold 40px Arial';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.fillText(roomId, 128, 64);
            
            const labelTexture = new THREE.CanvasTexture(canvas);
            const labelMaterial = new THREE.MeshBasicMaterial({ 
                map: labelTexture,
                transparent: true,
                side: THREE.DoubleSide
            });
            
            const labelGeometry = new THREE.PlaneGeometry(3, 1.5);
            const labelMesh = new THREE.Mesh(labelGeometry, labelMaterial);
            labelMesh.position.set(0, height/2, depth/2 + 0.1);
            labelMesh.rotation.y = Math.PI;
            roomGroup.add(labelMesh);
            
            // 클릭 가능한 객체로 등록
            roomObjects[roomId] = {
                mesh: roomMesh,
                group: roomGroup,
                info: {
                    id: roomId,
                    name: roomId,
                    type: roomId.includes('계단') ? '계단' : 
                          roomId.includes('화장실') ? '화장실' : 
                          roomId.includes('엘리베이터') ? '엘리베이터' : '강의실',
                    capacity: Math.floor(Math.random() * 60) + 20,
                    facilities: '빔프로젝터, 음향시설'
                }
            };
            
            return roomGroup;
        }
        
        // 층 변경 함수
        function changeFloor(floorId) {
            // 모든 층 숨기기
            Object.values(floorModels).forEach(floor => {
                floor.visible = false;
            });
            
            // 선택된 층 표시
            if (floorModels[floorId]) {
                floorModels[floorId].visible = true;
                currentFloor = floorId;
                
                // 층 버튼 활성화 상태 변경
                document.querySelectorAll('.floor-button').forEach(button => {
                    button.classList.remove('active');
                });
                
                document.querySelectorAll('.floor-button').forEach(button => {
                    if (button.textContent.includes(floorId.replace('F', '층').replace('B1', 'B1'))) {
                        button.classList.add('active');
                    }
                });
                
                // 카메라 위치 조정
                const yPosition = {
                    'B1': -5,
                    '1F': 0,
                    '2F': 5,
                    '3F': 10,
                    '4F': 15
                }[floorId];
                
                // 카메라 위치 애니메이션
                const targetPosition = new THREE.Vector3(0, yPosition + 10, 20);
                animateCamera(targetPosition);
            }
        }
        
        // 카메라 애니메이션 함수
        function animateCamera(targetPosition) {
            const startPosition = camera.position.clone();
            const duration = 1000; // 1초
            const startTime = Date.now();
            
            function updateCamera() {
                const elapsed = Date.now() - startTime;
                let progress = elapsed / duration;
                
                if (progress >= 1) {
                    camera.position.copy(targetPosition);
                    controls.update();
                    return;
                }
                
                // 이징 함수 적용
                progress = easeInOutCubic(progress);
                
                // 카메라 위치 보간
                camera.position.lerpVectors(startPosition, targetPosition, progress);
                controls.update();
                
                requestAnimationFrame(updateCamera);
            }
            
            updateCamera();
        }
        
        // 이징 함수
        function easeInOutCubic(t) {
            return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
        }
        
        // 윈도우 리사이즈 핸들러
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // 애니메이션 루프
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            
            // 강조된 객체 애니메이션 업데이트
            Object.values(roomObjects).forEach(room => {
                if (room.group.pulseAnimation) {
                    room.group.pulseAnimation();
                }
            });
            
            renderer.render(scene, camera);
        }
        
        // 레이캐스팅으로 객체 클릭 감지
        function initRaycaster() {
            const raycaster = new THREE.Raycaster();
            const mouse = new THREE.Vector2();
            
            window.addEventListener('click', (event) => {
                if (!isLoaded) return;
                
                // 마우스 좌표 계산
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
                
                // 레이캐스팅
                raycaster.setFromCamera(mouse, camera);
                
                // 현재 표시된 층의 객체만 검사
                const objects = Object.values(roomObjects)
                    .filter(obj => obj.group.parent && obj.group.parent.visible)
                    .map(obj => obj.mesh);
                
                const intersects = raycaster.intersectObjects(objects);
                
                if (intersects.length > 0) {
                    // 클릭된 객체 찾기
                    const clickedMesh = intersects[0].object;
                    const clickedRoomId = Object.keys(roomObjects).find(
                        id => roomObjects[id].mesh === clickedMesh
                    );
                    
                    if (clickedRoomId) {
                        showRoomInfo(clickedRoomId);
                    }
                } else {
                    // 배경 클릭 시 룸 정보 숨기기
                    document.querySelector('.room-info').style.display = 'none';
                }
            });
        }
        
        // 룸 정보 표시 함수
        function showRoomInfo(roomId) {
            const roomInfo = roomObjects[roomId].info;
            const infoElement = document.querySelector('.room-info');
            
            infoElement.querySelector('.room-title').textContent = roomInfo.name;
            
            let descriptionHTML = '';
            if (roomInfo.type === '강의실') {
                descriptionHTML = `
                    ${roomInfo.type} | 수용인원: ${roomInfo.capacity}명<br>
                    시설: ${roomInfo.facilities}
                `;
            } else {
                descriptionHTML = `${roomInfo.type}`;
            }
            
            infoElement.querySelector('.room-description').innerHTML = descriptionHTML;
            infoElement.style.display = 'block';
        }
        
        // 카메라 리셋
        function resetCamera() {
            const yPosition = {
                'B1': -5,
                '1F': 0,
                '2F': 5,
                '3F': 10,
                '4F': 15
            }[currentFloor];
            
            const targetPosition = new THREE.Vector3(0, yPosition + 10, 20);
            animateCamera(targetPosition);
            
            controls.target.set(0, yPosition, 0);
        }
        
        // 줌 인
        function zoomIn() {
            const zoomFactor = 0.8;
            camera.position.lerp(controls.target, 1 - zoomFactor);
            controls.update();
        }
        
        // 줌 아웃
        function zoomOut() {
            const zoomFactor = 1.2;
            const direction = new THREE.Vector3().subVectors(
                camera.position, controls.target
            ).normalize();
            
            const distance = camera.position.distanceTo(controls.target);
            camera.position.copy(controls.target).add(
                direction.multiplyScalar(distance * zoomFactor)
            );
            
            controls.update();
        }
        
        // 3D 건물 뷰 표시
        function show3DBuilding(buildingId) {
            currentBuilding = buildingId;
            document.getElementById('building3dView').style.display = 'block';
            document.querySelector('.view-title').textContent = buildingId;
            document.querySelector('.loading-screen').style.display = 'flex';
            
            // 3D 환경 초기화
            init3DEnvironment();
            
            // 레이캐스터 초기화 (한 번만)
            if (!window.raycasterInitialized) {
                initRaycaster();
                window.raycasterInitialized = true;
            }
            
            // 모델 로드
            loadBuildingModel(buildingId);
            
            // 층 버튼 초기 설정
            currentFloor = '2F';
            document.querySelectorAll('.floor-button').forEach(button => {
                button.classList.remove('active');
                if (button.textContent.includes('2층')) {
                    button.classList.add('active');
                }
            });
        }
        
        // 3D 건물 뷰 닫기
        function close3DBuilding() {
            document.getElementById('building3dView').style.display = 'none';
        }
        
        // 홈으로 이동
        function goToHome() {
            // 홈 페이지로 이동 로직
            alert('홈으로 이동합니다.');
        }
    </script>
</body>
</html>