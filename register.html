<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입 - 연성대학교</title>
    <link rel="stylesheet" href="register.css">
    
    <!-- EmailJS 라이브러리 추가 -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script>
        // EmailJS 초기화 (새로운 Public Key로)
        (function(){
            const PUBLIC_KEY = "SsbBsstNmRubY3laH";  // ✅ 새로 발급받은 Public Key
            
            if (typeof emailjs !== 'undefined') {
                try {
                    emailjs.init(PUBLIC_KEY);
                    console.log('✅ EmailJS HTML 초기화 완료');
                    console.log('🔑 새로운 Public Key 적용:', PUBLIC_KEY);
                } catch (error) {
                    console.error('❌ EmailJS 초기화 실패:', error);
                }
            } else {
                console.error('❌ EmailJS 라이브러리 로드 실패');
            }
        })();
    </script>
</head>
<body>
    <div class="container">
        <header>
            <div class="back-button" onclick="goBack()">←</div>
            <div class="header-title">회원가입</div>
        </header>
        
        <div class="register-container">
            <div class="register-title">연성대학교 캠퍼스 가이드 회원가입</div>
            
            <!-- 소셜 로그인 정보 표시 영역 (소셜 로그인으로 온 경우에만 표시) -->
            <div id="socialInfoBox" class="social-info" style="display: none;">
                <div class="social-title">
                    <span id="socialIcon" class="social-icon"></span>
                    <span id="socialType">소셜 계정</span>으로 회원가입
                </div>
                <div class="social-text">
                    <p>소셜 계정으로 간편하게 가입하세요. 학생 정보를 추가로 입력하여 캠퍼스 가이드 서비스를 이용하실 수 있습니다.</p>
                </div>
            </div>
            
            <form id="registerForm">
                <!-- 역할 선택 영역 -->
                <div class="form-group">
                    <label class="form-label">역할 선택</label>
                    <div class="role-selection">
                        <label class="role-option">
                            <input type="radio" name="userRole" value="student" checked>
                            <div class="role-card">
                                <div class="role-icon">🎓</div>
                                <div class="role-title">학생</div>
                                <div class="role-desc">10자리 학번으로 가입</div>
                            </div>
                        </label>
                        <label class="role-option">
                            <input type="radio" name="userRole" value="professor">
                            <div class="role-card">
                                <div class="role-icon">👨‍🏫</div>
                                <div class="role-title">교수</div>
                                <div class="role-desc">7자리 교번으로 가입</div>
                            </div>
                        </label>
                        <label class="role-option">
                            <input type="radio" name="userRole" value="staff">
                            <div class="role-card">
                                <div class="role-icon">👥</div>
                                <div class="role-title">교직원</div>
                                <div class="role-desc">7자리 직번으로 가입</div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- 권한 승인 안내 -->
                <div id="approvalNotice" class="approval-notice" style="display: none;">
                    <div class="notice-icon">⚠️</div>
                    <div class="notice-text">
                        <strong>교수/교직원 권한은 관리자 승인이 필요합니다.</strong><br>
                        가입 후 관리자 승인을 받기 전까지는 학생 권한으로 서비스를 이용하실 수 있습니다.
                    </div>
                </div>

                <!-- 교수/교직원 인증 섹션 -->
                <div id="verificationSection" class="verification-section" style="display: none;">
                    <!-- 동적으로 생성됨 -->
                </div>
                
                <!-- 기본 정보 입력 폼들 -->
                <div class="form-group">
                    <label class="form-label" id="idLabel">학번</label>
                    <input type="text" class="form-input" id="studentId" placeholder="학번을 입력하세요">
                    <div class="form-hint" id="idHint">예: 2024123456</div>
                    <div class="error-message" id="studentId-error">올바른 학번을 입력해주세요</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">이름</label>
                    <input type="text" class="form-input" id="name" placeholder="이름을 입력하세요">
                </div>
                
                <!-- 일반 회원가입인 경우에만 비밀번호 필드 표시 -->
                <div id="passwordFields">
                    <div class="form-group">
                        <label class="form-label">비밀번호</label>
                        <input type="password" class="form-input" id="password" placeholder="비밀번호를 입력하세요">
                        <div class="form-hint">영문, 숫자, 특수문자를 포함한 8자 이상</div>
                        <div class="error-message" id="password-error">영문, 숫자, 특수문자를 포함한 8자 이상 입력해주세요</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">비밀번호 확인</label>
                        <input type="password" class="form-input" id="confirmPassword" placeholder="비밀번호를 다시 입력하세요">
                        <div class="error-message" id="confirmPassword-error">비밀번호가 일치하지 않습니다</div>
                    </div>
                </div>
                
                <!-- 학과/부서 선택 -->
                <div class="form-group">
                    <label class="form-label">학과/부서</label>
                    <div class="department-container">
                        <input type="text" class="form-input" id="departmentInput" placeholder="학과명을 입력하거나 선택하세요" autocomplete="off">
                        <div class="department-dropdown" id="departmentDropdown">
                            <!-- 학과 옵션들 (기존과 동일) -->
                        </div>
                        <input type="hidden" id="selectedDepartment" name="department" value="">
                    </div>
                </div>
                
                <!-- 학년 선택 (학생인 경우에만) -->
                <div class="form-group" id="gradeGroup">
                    <label class="form-label">학년</label>
                    <div class="grade-dropdown">
                        <button type="button" class="grade-button" id="gradeDropdownBtn">학년을 선택하세요</button>
                        <div class="grade-content" id="gradeDropdown">
                            <div class="grade-option" data-value="1">1학년</div>
                            <div class="grade-option" data-value="2">2학년</div>
                            <div class="grade-option" data-value="3">3학년</div>
                            <div class="grade-option" data-value="4">4학년</div>
                        </div>
                        <input type="hidden" id="selectedGrade" name="grade" value="">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">휴대폰 번호</label>
                    <input type="tel" class="form-input" id="phone" placeholder="휴대폰 번호를 입력하세요" maxlength="13" oninput="formatPhoneNumber(this)">
                    <div class="error-message" id="phone-error">010으로 시작하는 11자리 번호를 입력해주세요</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">이메일</label>
                    <input type="email" class="form-input" id="email" placeholder="이메일을 입력하세요">
                    <div class="error-message" id="email-error">올바른 이메일 형식을 입력해주세요</div>
                </div>
                
                <!-- 약관 동의 -->
                <div class="agreement">
                    <div class="agreement-title">이용약관 동의</div>
                    <div class="agreement-text">
                        [이용약관 내용...]
                    </div>
                    <label class="check-item">
                        <input type="checkbox" id="agreeTerms"> 이용약관에 동의합니다 (필수)
                    </label>
                </div>
                
                <div class="agreement">
                    <div class="agreement-title">개인정보 수집 및 이용 동의</div>
                    <div class="agreement-text">
                        [개인정보 처리방침 내용...]
                    </div>
                    <label class="check-item">
                        <input type="checkbox" id="agreePrivacy"> 개인정보 수집 및 이용에 동의합니다 (필수)
                    </label>
                </div>
                
                <button type="button" class="register-button" onclick="register()">회원가입</button>
            </form>
        </div>
    </div>
    
    <!-- 보안 강화된 JavaScript 파일 로드 -->
    <script src="register.js"></script>
    
    <!-- 개발용 테스트 스크립트 -->
    <script>
        // 페이지 로드 완료 후 EmailJS 설정 테스트
        window.addEventListener('load', function() {
            setTimeout(() => {
                console.log('🎯 새로운 Public Key로 EmailJS 준비 완료');
                console.log('💡 브라우저 콘솔에서 testEmailJS() 실행하여 테스트 가능');
                
                // 자동 설정 확인
                if (typeof checkEmailJSConfig === 'function') {
                    checkEmailJSConfig();
                }
            }, 1000);
        });
    </script>
</body>
</html>