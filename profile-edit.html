<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>개인정보 수정 - 연성대학교 캠퍼스 가이드</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 768px;
            margin: 0 auto;
            background-color: white;
            min-height: 100vh;
        }
        
        header {
            background-color: #c62917;
            color: white;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .back-button {
            display: flex;
            align-items: center;
            gap: 4px;
            color: white;
            text-decoration: none;
            cursor: pointer;
        }
        
        .page-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .content-section {
            padding: 16px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #333;
        }
        
        .profile-form {
            display: flex;
            flex-direction: column;
        }
        
        .profile-image-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding: 16px;
        }
        
        .profile-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            margin-bottom: 8px;
            position: relative;
        }
        
        .edit-image-button {
            position: absolute;
            right: 0;
            bottom: 0;
            width: 30px;
            height: 30px;
            background-color: #c62917;
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        .form-group {
            margin-bottom: 14px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            color: #555;
            margin-bottom: 6px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 15px;
        }
        
        .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 15px;
            background-color: white;
        }
        
        .form-readonly {
            background-color: #f9f9f9;
            color: #777;
        }
        
        .divider {
            height: 1px;
            background-color: #eee;
            margin: 20px 0;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .save-button {
            flex: 1;
            padding: 14px;
            background-color: #c62917;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .cancel-button {
            flex: 1;
            padding: 14px;
            background-color: #f0f0f0;
            color: #333;
            border: none;
            border-radius: 4px;
            font-size: 15px;
            cursor: pointer;
        }
        
        .section-divider {
            padding: 8px 16px;
            background-color: #f9f9f9;
            font-weight: bold;
            color: #555;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
        }
        
        .error-message {
            color: #c62917;
            font-size: 13px;
            margin-top: 4px;
            display: none;
        }
        
        .has-error .form-input {
            border-color: #c62917;
        }
        
        .has-error .error-message {
            display: block;
        }
        
        .notice-text {
            font-size: 13px;
            color: #666;
            margin-top: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="back-button" onclick="goToBack()">
                <span>←</span>
                <span>뒤로</span>
            </div>
            <div class="page-title">개인정보 수정</div>
            <div style="width: 40px;"></div> <!-- 균형을 위한 빈 공간 -->
        </header>
        
        <div class="profile-image-section">
            <div class="profile-image" id="profileImage">
                👨‍🎓
                <div class="edit-image-button" onclick="changeProfileImage()">+</div>
            </div>
        </div>
        
        <form class="profile-form" id="profileEditForm" onsubmit="return saveProfile(event)">
            <div class="section-divider">기본 정보</div>
            
            <div class="content-section">
                <div class="form-group">
                    <label class="form-label" for="studentId">학번</label>
                    <input type="text" id="studentId" class="form-input form-readonly" readonly>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="name">이름</label>
                    <input type="text" id="name" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="department">학과</label>
                    <select id="department" class="form-select" required>
                        <option value="computerScience">컴퓨터정보학과</option>
                        <option value="business">경영학과</option>
                        <option value="nursing">간호학과</option>
                        <option value="engineering">공학계열</option>
                        <option value="arts">예술계열</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="grade">학년</label>
                    <select id="grade" class="form-select" required>
                        <option value="1">1학년</option>
                        <option value="2">2학년</option>
                        <option value="3">3학년</option>
                        <option value="4">4학년</option>
                    </select>
                </div>
            </div>
            
            <div class="section-divider">계정 정보</div>
            
            <div class="content-section">
                <div class="form-group">
                    <label class="form-label" for="email">이메일</label>
                    <input type="email" id="email" class="form-input" placeholder="이메일 주소 입력" required>
                    <div class="error-message">올바른 이메일 주소를 입력해주세요.</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="phone">전화번호</label>
                    <input type="tel" id="phone" class="form-input" placeholder="010-0000-0000" required>
                    <div class="error-message">올바른 전화번호 형식을 입력해주세요.</div>
                </div>
            </div>
            
            <div class="section-divider">비밀번호 변경</div>
            
            <div class="content-section">
                <div class="form-group">
                    <label class="form-label" for="currentPassword">현재 비밀번호</label>
                    <input type="password" id="currentPassword" class="form-input" placeholder="현재 비밀번호 입력">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="newPassword">새 비밀번호</label>
                    <input type="password" id="newPassword" class="form-input" placeholder="새 비밀번호 입력">
                    <div class="notice-text">영문, 숫자, 특수문자 조합 8자 이상</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="confirmPassword">새 비밀번호 확인</label>
                    <input type="password" id="confirmPassword" class="form-input" placeholder="새 비밀번호 재입력">
                    <div class="error-message">비밀번호가 일치하지 않습니다.</div>
                </div>
                
                <div class="button-group">
                    <button type="button" class="cancel-button" onclick="goToBack()">취소</button>
                    <button type="submit" class="save-button">저장</button>
                </div>
            </div>
        </form>
    </div>

    <script>
        // 페이지 로드 시 실행되는 함수
        document.addEventListener('DOMContentLoaded', function() {
            // 로그인 상태 체크
            checkLoginStatus();
            
            // 폼 입력 필드 유효성 검사 이벤트 리스너 등록
            setupFormValidation();
        });
        
        // 로그인 상태 확인 및 프로필 정보 로드
        function checkLoginStatus() {
            // 로컬 스토리지에서 현재 로그인된 사용자 정보 가져오기
            const currentUser = localStorage.getItem('currentLoggedInUser');
            
            if (!currentUser) {
                // 로그인되지 않은 경우 로그인 페이지로 리다이렉트
                alert('로그인이 필요한 서비스입니다.');
                window.location.href = 'login.html';
                return;
            }
            
            // 프로필 정보 로드
            loadProfileInfo(currentUser);
        }
        
        // 프로필 정보 로드
        function loadProfileInfo(studentId) {
            // 기본 정보 설정
            document.getElementById('studentId').value = studentId;
            
            // 로컬 스토리지에서 사용자 정보 가져오기
            const name = localStorage.getItem(`user_${studentId}_name`) || '조희정';
            const department = localStorage.getItem(`user_${studentId}_department`) || 'business';
            const grade = localStorage.getItem(`user_${studentId}_grade`) || '3';
            const email = localStorage.getItem(`user_${studentId}_email`) || 'student@yeonsung.ac.kr';
            const phone = localStorage.getItem(`user_${studentId}_phone`) || '010-1234-5678';
            
            // 폼에 정보 설정
            document.getElementById('name').value = name;
            document.getElementById('department').value = department;
            document.getElementById('grade').value = grade;
            document.getElementById('email').value = email;
            document.getElementById('phone').value = phone;
        }
        
        // 폼 유효성 검사 설정
        function setupFormValidation() {
            const emailInput = document.getElementById('email');
            const phoneInput = document.getElementById('phone');
            const newPasswordInput = document.getElementById('newPassword');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            
            // 이메일 입력 검사
            emailInput.addEventListener('blur', function() {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                const isValid = emailRegex.test(this.value);
                validateField(this, isValid);
            });
            
            // 전화번호 입력 검사
            phoneInput.addEventListener('blur', function() {
                const phoneRegex = /^010-\d{4}-\d{4}$/;
                const isValid = phoneRegex.test(this.value);
                validateField(this, isValid);
            });
            
            // 새 비밀번호 확인 일치 검사
            confirmPasswordInput.addEventListener('input', function() {
                const isValid = this.value === newPasswordInput.value;
                validateField(this, isValid);
            });
        }
        
        // 필드 유효성 검사 및 에러 표시
        function validateField(field, isValid) {
            const formGroup = field.parentElement;
            
            if (!isValid && field.value.trim() !== '') {
                formGroup.classList.add('has-error');
            } else {
                formGroup.classList.remove('has-error');
            }
        }
        
        // 프로필 저장
        function saveProfile(event) {
            event.preventDefault();
            
            // 필수 입력 검사
            const name = document.getElementById('name').value.trim();
            const department = document.getElementById('department').value;
            const grade = document.getElementById('grade').value;
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            
            if (!name || !department || !grade || !email || !phone) {
                alert('모든 필수 항목을 입력해주세요.');
                return false;
            }
            
            // 비밀번호 변경 검사
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword) {
                if (!currentPassword) {
                    alert('현재 비밀번호를 입력해주세요.');
                    return false;
                }
                
                if (newPassword !== confirmPassword) {
                    alert('새 비밀번호와 확인 비밀번호가 일치하지 않습니다.');
                    return false;
                }
                
                // 비밀번호 정책 검사 (영문, 숫자, 특수문자 조합 8자 이상)
                const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/;
                if (!passwordRegex.test(newPassword)) {
                    alert('비밀번호는 영문, 숫자, 특수문자를 포함하여 8자 이상이어야 합니다.');
                    return false;
                }
            }
            
            // 로컬 스토리지에 저장
            const studentId = document.getElementById('studentId').value;
            localStorage.setItem(`user_${studentId}_name`, name);
            localStorage.setItem(`user_${studentId}_department`, department);
            localStorage.setItem(`user_${studentId}_grade`, grade);
            localStorage.setItem(`user_${studentId}_email`, email);
            localStorage.setItem(`user_${studentId}_phone`, phone);
            
            if (newPassword) {
                localStorage.setItem(`user_${studentId}_password`, newPassword);
            }
            
            alert('개인정보가 성공적으로 수정되었습니다.');
            
            // 이전 페이지로 이동
            goToBack();
            
            return false;
        }
        
        // 프로필 이미지 변경
        function changeProfileImage() {
            // 실제 구현에서는 파일 업로드 기능 연결
            alert('프로필 이미지 변경 기능은 현재 준비 중입니다.');
        }
        
        // 이전 페이지로 이동
        function goToBack() {
            window.history.back();
        }
    </script>
</body>
</html>