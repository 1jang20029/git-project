<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°œì¸ì •ë³´ ìˆ˜ì • - ì—°ì„±ëŒ€í•™êµ ìº í¼ìŠ¤ ê°€ì´ë“œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 768px;
            margin: 0 auto;
            background-color: white;
            min-height: 100vh;
        }
        
        header {
            background-color: #c62917;
            color: white;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .back-button {
            display: flex;
            align-items: center;
            gap: 4px;
            color: white;
            text-decoration: none;
            cursor: pointer;
        }
        
        .page-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .content-section {
            padding: 16px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #333;
        }
        
        .profile-form {
            display: flex;
            flex-direction: column;
        }
        
        .profile-image-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding: 16px;
        }
        
        .profile-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            margin-bottom: 8px;
            position: relative;
        }
        
        .edit-image-button {
            position: absolute;
            right: 0;
            bottom: 0;
            width: 30px;
            height: 30px;
            background-color: #c62917;
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        .form-group {
            margin-bottom: 14px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            color: #555;
            margin-bottom: 6px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 15px;
        }
        
        .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 15px;
            background-color: white;
        }
        
        .form-readonly {
            background-color: #f9f9f9;
            color: #777;
        }
        
        .divider {
            height: 1px;
            background-color: #eee;
            margin: 20px 0;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .save-button {
            flex: 1;
            padding: 14px;
            background-color: #c62917;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .cancel-button {
            flex: 1;
            padding: 14px;
            background-color: #f0f0f0;
            color: #333;
            border: none;
            border-radius: 4px;
            font-size: 15px;
            cursor: pointer;
        }
        
        .section-divider {
            padding: 8px 16px;
            background-color: #f9f9f9;
            font-weight: bold;
            color: #555;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
        }
        
        .error-message {
            color: #c62917;
            font-size: 13px;
            margin-top: 4px;
            display: none;
        }
        
        .has-error .form-input {
            border-color: #c62917;
        }
        
        .has-error .error-message {
            display: block;
        }
        
        .notice-text {
            font-size: 13px;
            color: #666;
            margin-top: 6px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="back-button" onclick="goToBack()">
                <span>â†</span>
                <span>ë’¤ë¡œ</span>
            </div>
            <div class="page-title">ê°œì¸ì •ë³´ ìˆ˜ì •</div>
            <div style="width: 40px;"></div> <!-- ê· í˜•ì„ ìœ„í•œ ë¹ˆ ê³µê°„ -->
        </header>
        
        <div class="profile-image-section">
            <div class="profile-image" id="profileImage">
                ğŸ‘¨â€ğŸ“
                <div class="edit-image-button" onclick="changeProfileImage()">+</div>
            </div>
        </div>
        
        <form class="profile-form" id="profileEditForm" onsubmit="return saveProfile(event)">
            <div class="section-divider">ê¸°ë³¸ ì •ë³´</div>
            
            <div class="content-section">
                <div class="form-group">
                    <label class="form-label" for="studentId">í•™ë²ˆ</label>
                    <input type="text" id="studentId" class="form-input form-readonly" readonly>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="name">ì´ë¦„</label>
                    <input type="text" id="name" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="department">í•™ê³¼</label>
                    <select id="department" class="form-select" required>
                        <option value="computerScience">ì»´í“¨í„°ì •ë³´í•™ê³¼</option>
                        <option value="business">ê²½ì˜í•™ê³¼</option>
                        <option value="nursing">ê°„í˜¸í•™ê³¼</option>
                        <option value="engineering">ê³µí•™ê³„ì—´</option>
                        <option value="arts">ì˜ˆìˆ ê³„ì—´</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="grade">í•™ë…„</label>
                    <select id="grade" class="form-select" required>
                        <option value="1">1í•™ë…„</option>
                        <option value="2">2í•™ë…„</option>
                        <option value="3">3í•™ë…„</option>
                        <option value="4">4í•™ë…„</option>
                    </select>
                </div>
            </div>
            
            <div class="section-divider">ê³„ì • ì •ë³´</div>
            
            <div class="content-section">
                <div class="form-group">
                    <label class="form-label" for="email">ì´ë©”ì¼</label>
                    <input type="email" id="email" class="form-input" placeholder="ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥" required>
                    <div class="error-message">ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="phone">ì „í™”ë²ˆí˜¸</label>
                    <input type="tel" id="phone" class="form-input" placeholder="010-0000-0000" required>
                    <div class="error-message">ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
                </div>
            </div>
            
            <div class="section-divider">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
            
            <div class="content-section">
                <div class="form-group">
                    <label class="form-label" for="currentPassword">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="currentPassword" class="form-input" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="newPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="newPassword" class="form-input" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                    <div class="notice-text">ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì ì¡°í•© 8ì ì´ìƒ</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="confirmPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                    <input type="password" id="confirmPassword" class="form-input" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥">
                    <div class="error-message">ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
                </div>
                
                <div class="button-group">
                    <button type="button" class="cancel-button" onclick="goToBack()">ì·¨ì†Œ</button>
                    <button type="submit" class="save-button">ì €ì¥</button>
                </div>
            </div>
        </form>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
        document.addEventListener('DOMContentLoaded', function() {
            // ë¡œê·¸ì¸ ìƒíƒœ ì²´í¬
            checkLoginStatus();
            
            // í¼ ì…ë ¥ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            setupFormValidation();
        });
        
        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ë° í”„ë¡œí•„ ì •ë³´ ë¡œë“œ
        function checkLoginStatus() {
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const currentUser = localStorage.getItem('currentLoggedInUser');
            
            if (!currentUser) {
                // ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ê²½ìš° ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.');
                window.location.href = 'login.html';
                return;
            }
            
            // í”„ë¡œí•„ ì •ë³´ ë¡œë“œ
            loadProfileInfo(currentUser);
        }
        
        // í”„ë¡œí•„ ì •ë³´ ë¡œë“œ
        function loadProfileInfo(studentId) {
            // ê¸°ë³¸ ì •ë³´ ì„¤ì •
            document.getElementById('studentId').value = studentId;
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const name = localStorage.getItem(`user_${studentId}_name`) || 'ì¡°í¬ì •';
            const department = localStorage.getItem(`user_${studentId}_department`) || 'business';
            const grade = localStorage.getItem(`user_${studentId}_grade`) || '3';
            const email = localStorage.getItem(`user_${studentId}_email`) || 'student@yeonsung.ac.kr';
            const phone = localStorage.getItem(`user_${studentId}_phone`) || '010-1234-5678';
            
            // í¼ì— ì •ë³´ ì„¤ì •
            document.getElementById('name').value = name;
            document.getElementById('department').value = department;
            document.getElementById('grade').value = grade;
            document.getElementById('email').value = email;
            document.getElementById('phone').value = phone;
        }
        
        // í¼ ìœ íš¨ì„± ê²€ì‚¬ ì„¤ì •
        function setupFormValidation() {
            const emailInput = document.getElementById('email');
            const phoneInput = document.getElementById('phone');
            const newPasswordInput = document.getElementById('newPassword');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            
            // ì´ë©”ì¼ ì…ë ¥ ê²€ì‚¬
            emailInput.addEventListener('blur', function() {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                const isValid = emailRegex.test(this.value);
                validateField(this, isValid);
            });
            
            // ì „í™”ë²ˆí˜¸ ì…ë ¥ ê²€ì‚¬
            phoneInput.addEventListener('blur', function() {
                const phoneRegex = /^010-\d{4}-\d{4}$/;
                const isValid = phoneRegex.test(this.value);
                validateField(this, isValid);
            });
            
            // ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì¼ì¹˜ ê²€ì‚¬
            confirmPasswordInput.addEventListener('input', function() {
                const isValid = this.value === newPasswordInput.value;
                validateField(this, isValid);
            });
        }
        
        // í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ ë° ì—ëŸ¬ í‘œì‹œ
        function validateField(field, isValid) {
            const formGroup = field.parentElement;
            
            if (!isValid && field.value.trim() !== '') {
                formGroup.classList.add('has-error');
            } else {
                formGroup.classList.remove('has-error');
            }
        }
        
        // í”„ë¡œí•„ ì €ì¥
        function saveProfile(event) {
            event.preventDefault();
            
            // í•„ìˆ˜ ì…ë ¥ ê²€ì‚¬
            const name = document.getElementById('name').value.trim();
            const department = document.getElementById('department').value;
            const grade = document.getElementById('grade').value;
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            
            if (!name || !department || !grade || !email || !phone) {
                alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }
            
            // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ê²€ì‚¬
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword) {
                if (!currentPassword) {
                    alert('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return false;
                }
                
                if (newPassword !== confirmPassword) {
                    alert('ìƒˆ ë¹„ë°€ë²ˆí˜¸ì™€ í™•ì¸ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    return false;
                }
                
                // ë¹„ë°€ë²ˆí˜¸ ì •ì±… ê²€ì‚¬ (ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì ì¡°í•© 8ì ì´ìƒ)
                const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/;
                if (!passwordRegex.test(newPassword)) {
                    alert('ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•˜ì—¬ 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                    return false;
                }
            }
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            const studentId = document.getElementById('studentId').value;
            localStorage.setItem(`user_${studentId}_name`, name);
            localStorage.setItem(`user_${studentId}_department`, department);
            localStorage.setItem(`user_${studentId}_grade`, grade);
            localStorage.setItem(`user_${studentId}_email`, email);
            localStorage.setItem(`user_${studentId}_phone`, phone);
            
            if (newPassword) {
                localStorage.setItem(`user_${studentId}_password`, newPassword);
            }
            
            alert('ê°œì¸ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
            
            // ì´ì „ í˜ì´ì§€ë¡œ ì´ë™
            goToBack();
            
            return false;
        }
        
        // í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€ê²½
        function changeProfileImage() {
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” íŒŒì¼ ì—…ë¡œë“œ ê¸°ëŠ¥ ì—°ê²°
            alert('í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€ê²½ ê¸°ëŠ¥ì€ í˜„ì¬ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
        }
        
        // ì´ì „ í˜ì´ì§€ë¡œ ì´ë™
        function goToBack() {
            window.history.back();
        }
    </script>
</body>
</html>