<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°œì¸ì •ë³´ ìˆ˜ì • - ì—°ì„±ëŒ€í•™êµ ìº í¼ìŠ¤ ê°€ì´ë“œ</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=3836f1efa74c42d67fb12b4c2dda5aa9"></script> 
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 768px;
            margin: 0 auto;
            background-color: white;
            min-height: 100vh;
        }
        
        header {
            background-color: #c62917;
            color: white;
            padding: 12px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .back-button {
            display: flex;
            align-items: center;
            gap: 4px;
            color: white;
            text-decoration: none;
            cursor: pointer;
        }
        
        .page-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .content-section {
            padding: 16px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #333;
        }
        
        .profile-form {
            display: flex;
            flex-direction: column;
        }
        
        /* ìˆ˜ì •ëœ í”„ë¡œí•„ ì´ë¯¸ì§€ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .profile-image-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 24px 16px;
            position: relative;
        }
        
        /* ìˆ˜ì •ëœ í”„ë¡œí•„ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
        .profile-image-container {
            position: relative;
            width: 100px;
            height: 100px;
            margin-bottom: 16px;
        }
        
        .profile-image {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            overflow: hidden;
        }
        
        /* í—¤ë”ì— ìˆëŠ” í”„ë¡œí•„ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
        .header-profile {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            margin-left: auto; /* ìš°ì¸¡ìœ¼ë¡œ ì •ë ¬ */
        }
        
        /* ìˆ˜ì •ëœ í¸ì§‘ ë²„íŠ¼ ìŠ¤íƒ€ì¼ - í”„ë¡œí•„ê³¼ ê²¹ì¹˜ë„ë¡ */
        .edit-image-button {
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 32px;
            height: 32px;
            background-color: #c62917;
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 10;
            font-size: 18px;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .form-group {
            margin-bottom: 14px;
            position: relative;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            color: #555;
            margin-bottom: 6px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 15px;
        }
        
        .form-select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 15px;
            background-color: white;
        }
        
        .form-readonly {
            background-color: #f9f9f9;
            color: #777;
        }
        
        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 4px 4px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .autocomplete-category {
            background-color: #f5f5f5;
            padding: 8px 12px;
            font-size: 13px;
            font-weight: bold;
            color: #666;
            border-bottom: 1px solid #eee;
        }
        
        .autocomplete-item {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            font-size: 15px;
            padding-left: 16px;
        }
        
        .autocomplete-item:hover {
            background-color: #f5f5f5;
        }
        
        .autocomplete-item:last-child {
            border-bottom: none;
        }
        
        .autocomplete-item.highlighted {
            background-color: #e8f4fd;
        }
        
        .divider {
            height: 1px;
            background-color: #eee;
            margin: 20px 0;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .save-button {
            flex: 1;
            padding: 14px;
            background-color: #c62917;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .cancel-button {
            flex: 1;
            padding: 14px;
            background-color: #f0f0f0;
            color: #333;
            border: none;
            border-radius: 4px;
            font-size: 15px;
            cursor: pointer;
        }
        
        .section-divider {
            padding: 8px 16px;
            background-color: #f9f9f9;
            font-weight: bold;
            color: #555;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
        }
        
        .error-message {
            color: #c62917;
            font-size: 13px;
            margin-top: 4px;
            display: none;
        }
        
        .has-error .form-input {
            border-color: #c62917;
        }
        
        .has-error .error-message {
            display: block;
        }
        
        .notice-text {
            font-size: 13px;
            color: #666;
            margin-top: 6px;
        }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ê°œì„  */
        .modal-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 12px;
            width: 90%;
            max-width: 450px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 16px;
            border-bottom: 1px solid #eee;
            text-align: center;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: bold;
            margin: 0;
        }
        
        .modal-section {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-section-title {
            font-size: 16px;
            font-weight: bold;
            margin: 0 0 16px 0;
            text-align: center;
        }
        
        .upload-button {
            display: block;
            width: 100%;
            padding: 14px 0;
            background-color: #c62917;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            margin-bottom: 16px;
        }
        
        .preview-container {
            margin-top: 16px;
            display: none;
            text-align: center;
        }
        
        .preview-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 16px;
            display: block;
        }
        
        .apply-button {
            display: inline-block;
            padding: 10px 20px;
            background-color: #c62917;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .image-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
        }
        
        .image-option {
            aspect-ratio: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #eee;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .image-option:hover {
            border-color: #c62917;
            background-color: #fff8f8;
        }
        
        .emoji-image {
            font-size: 36px;
        }
        
        .modal-footer {
            padding: 16px;
            text-align: center;
            background-color: #f5f5f5;
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="back-button" onclick="goToBack()">
                <span>â†</span>
                <span>ë’¤ë¡œ</span>
            </div>
            <div class="page-title">ê°œì¸ì •ë³´ ìˆ˜ì •</div>
            <div class="header-profile" id="headerProfileImage">
                <!-- ì—¬ê¸°ì— í—¤ë” í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ë“¤ì–´ê°‘ë‹ˆë‹¤ -->
            </div>
        </header>
        
        <div class="profile-image-section">
            <div class="profile-image-container">
                <div class="profile-image" id="profileImage">
                    ğŸ‘¨â€ğŸ“
                </div>
                <div class="edit-image-button" onclick="changeProfileImage()">+</div>
            </div>
        </div>
        
        <form class="profile-form" id="profileEditForm" onsubmit="return saveProfile(event)">
            <div class="section-divider">ê¸°ë³¸ ì •ë³´</div>
            
            <div class="content-section">
                <div class="form-group">
                    <label class="form-label" for="studentId">í•™ë²ˆ</label>
                    <input type="text" id="studentId" class="form-input form-readonly" readonly>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="name">ì´ë¦„</label>
                    <input type="text" id="name" class="form-input" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="department">í•™ê³¼</label>
                    <input type="text" id="department" class="form-input" placeholder="í•™ê³¼ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required autocomplete="off">
                    <div class="autocomplete-dropdown" id="departmentDropdown"></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="grade">í•™ë…„</label>
                    <select id="grade" class="form-select" required>
                        <option value="1">1í•™ë…„</option>
                        <option value="2">2í•™ë…„</option>
                        <option value="3">3í•™ë…„</option>
                        <option value="4">4í•™ë…„</option>
                    </select>
                </div>
            </div>
            
            <div class="section-divider">ê³„ì • ì •ë³´</div>
            
            <div class="content-section">
                <div class="form-group">
                    <label class="form-label" for="email">ì´ë©”ì¼</label>
                    <input type="email" id="email" class="form-input" placeholder="ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥" required>
                    <div class="error-message">ì˜¬ë°”ë¥¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="phone">ì „í™”ë²ˆí˜¸</label>
                    <input type="tel" id="phone" class="form-input" placeholder="010-0000-0000" required>
                    <div class="error-message">ì˜¬ë°”ë¥¸ ì „í™”ë²ˆí˜¸ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>
                </div>
            </div>
            
            <div class="section-divider">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</div>
            
            <div class="content-section">
                <div class="form-group">
                    <label class="form-label" for="currentPassword">í˜„ì¬ ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="currentPassword" class="form-input" placeholder="í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="newPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="newPassword" class="form-input" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                    <div class="notice-text">ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì ì¡°í•© 8ì ì´ìƒ</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="confirmPassword">ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                    <input type="password" id="confirmPassword" class="form-input" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥">
                    <div class="error-message">ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</div>
                </div>
                
                <div class="button-group">
                    <button type="button" class="cancel-button" onclick="goToBack()">ì·¨ì†Œ</button>
                    <button type="submit" class="save-button">ì €ì¥</button>
                </div>
            </div>
        </form>
    </div>

    <script>
        // í•™ê³¼ ëª©ë¡ ë°°ì—´ (ê³„ì—´ë³„ ë¶„ë¥˜)
        const departments = [
            // ìŠ¤ë§ˆíŠ¸ ICTê³„ì—´
            { id: 'electronics', name: 'ì „ìê³µí•™ê³¼', category: 'ìŠ¤ë§ˆíŠ¸ ICTê³„ì—´' },
            { id: 'informationCommunication', name: 'ì •ë³´í†µì‹ ê³¼', category: 'ìŠ¤ë§ˆíŠ¸ ICTê³„ì—´' },
            { id: 'electrical', name: 'ì „ê¸°ê³¼', category: 'ìŠ¤ë§ˆíŠ¸ ICTê³„ì—´' },
            { id: 'computerSoftware', name: 'ì»´í“¨í„°ì†Œí”„íŠ¸ì›¨ì–´ê³¼', category: 'ìŠ¤ë§ˆíŠ¸ ICTê³„ì—´' },
            
            // ë¼ì´í”„ë””ìì¸ê³„ì—´
            { id: 'architecture', name: 'ê±´ì¶•ê³¼', category: 'ë¼ì´í”„ë””ìì¸ê³„ì—´' },
            { id: 'interiorArchitecture', name: 'ì‹¤ë‚´ê±´ì¶•ê³¼', category: 'ë¼ì´í”„ë””ìì¸ê³„ì—´' },
            { id: 'fashionDesignBusiness', name: 'íŒ¨ì…˜ë””ìì¸ë¹„ì¦ˆë‹ˆìŠ¤ê³¼', category: 'ë¼ì´í”„ë””ìì¸ê³„ì—´' },
            { id: 'beautyStylistHair', name: 'ë·°í‹°ìŠ¤íƒ€ì¼ë¦¬ìŠ¤íŠ¸ê³¼ í—¤ì–´ë””ìì¸ì „ê³µ', category: 'ë¼ì´í”„ë””ìì¸ê³„ì—´' },
            { id: 'beautyStylistMakeup', name: 'ë·°í‹°ìŠ¤íƒ€ì¼ë¦¬ìŠ¤íŠ¸ê³¼ ë©”ì´í¬ì—…ì „ê³µ', category: 'ë¼ì´í”„ë””ìì¸ê³„ì—´' },
            { id: 'beautyStylistSkincare', name: 'ë·°í‹°ìŠ¤íƒ€ì¼ë¦¬ìŠ¤íŠ¸ê³¼ ìŠ¤í‚¨ì¼€ì–´ì „ê³µ', category: 'ë¼ì´í”„ë””ìì¸ê³„ì—´' },
            
            // ë¬¸í™”ì½˜í…ì¸ ê³„ì—´
            { id: 'gameContent', name: 'ê²Œì„ì½˜í…ì¸ ê³¼', category: 'ë¬¸í™”ì½˜í…ì¸ ê³„ì—´' },
            { id: 'webtoonContent', name: 'ì›¹íˆ°ë§Œí™”ì½˜í…ì¸ ê³¼', category: 'ë¬¸í™”ì½˜í…ì¸ ê³„ì—´' },
            { id: 'videoContentProduction', name: 'ì˜ìƒì½˜í…ì¸ ê³¼ ì˜ìƒì½˜í…ì¸ ì œì‘ì „ê³µ', category: 'ë¬¸í™”ì½˜í…ì¸ ê³„ì—´' },
            { id: 'videoContentNewMedia', name: 'ì˜ìƒì½˜í…ì¸ ê³¼ ë‰´ë¯¸ë””ì–´ì½˜í…ì¸ ì „ê³µ', category: 'ë¬¸í™”ì½˜í…ì¸ ê³„ì—´' },
            { id: 'visualDesign', name: 'ì‹œê°ë””ìì¸ê³¼', category: 'ë¬¸í™”ì½˜í…ì¸ ê³„ì—´' },
            { id: 'kpop', name: 'K-POPê³¼', category: 'ë¬¸í™”ì½˜í…ì¸ ê³„ì—´' },
            
            // ì‚¬íšŒÂ·êµìœ¡ê³„ì—´
            { id: 'distributionLogistics', name: 'ìœ í†µë¬¼ë¥˜ê³¼', category: 'ì‚¬íšŒÂ·êµìœ¡ê³„ì—´' },
            { id: 'businessAdministration', name: 'ê²½ì˜í•™ê³¼', category: 'ì‚¬íšŒÂ·êµìœ¡ê³„ì—´' },
            { id: 'taxAccounting', name: 'ì„¸ë¬´íšŒê³„ê³¼', category: 'ì‚¬íšŒÂ·êµìœ¡ê³„ì—´' },
            { id: 'nationalDefense', name: 'êµ­ë°©êµ°ì‚¬í•™ê³¼', category: 'ì‚¬íšŒÂ·êµìœ¡ê³„ì—´' },
            { id: 'policeSecurity', name: 'ê²½ì°°ê²½í˜¸ë³´ì•ˆê³¼', category: 'ì‚¬íšŒÂ·êµìœ¡ê³„ì—´' },
            { id: 'socialWelfare', name: 'ì‚¬íšŒë³µì§€ê³¼', category: 'ì‚¬íšŒÂ·êµìœ¡ê³„ì—´' },
            { id: 'socialWelfareManagement', name: 'ì‚¬íšŒë³µì§€ê²½ì˜ê³¼', category: 'ì‚¬íšŒÂ·êµìœ¡ê³„ì—´' },
            { id: 'earlyChildhoodEducation', name: 'ìœ ì•„êµìœ¡ê³¼', category: 'ì‚¬íšŒÂ·êµìœ¡ê³„ì—´' },
            { id: 'earlyChildhoodSpecial', name: 'ìœ ì•„íŠ¹ìˆ˜ì¬í™œê³¼', category: 'ì‚¬íšŒÂ·êµìœ¡ê³„ì—´' },
            { id: 'childPsychology', name: 'ì‚¬íšŒë³µì§€ê³¼ ì•„ë™ì‹¬ë¦¬ë³´ìœ¡ì „ê³µ', category: 'ì‚¬íšŒÂ·êµìœ¡ê³„ì—´' },
            
            // ë³´ê±´ìƒëª…ê³„ì—´
            { id: 'dentalHygiene', name: 'ì¹˜ìœ„ìƒê³¼', category: 'ë³´ê±´ìƒëª…ê³„ì—´' },
            { id: 'dentalTechnology', name: 'ì¹˜ê¸°ê³µê³¼', category: 'ë³´ê±´ìƒëª…ê³„ì—´' },
            { id: 'occupationalTherapy', name: 'ì‘ì—…ì¹˜ë£Œ(ì‹¬ë¦¬)ê³¼', category: 'ë³´ê±´ìƒëª…ê³„ì—´' },
            { id: 'emergencyMedical', name: 'ì‘ê¸‰êµ¬ì¡°ê³¼', category: 'ë³´ê±´ìƒëª…ê³„ì—´' },
            { id: 'healthMedicalAdmin', name: 'ë³´ê±´ì˜ë£Œí–‰ì •ê³¼', category: 'ë³´ê±´ìƒëª…ê³„ì—´' },
            { id: 'sportsRehabilitation', name: 'ìŠ¤í¬ì¸ ì¬í™œê³¼', category: 'ë³´ê±´ìƒëª…ê³„ì—´' },
            { id: 'foodNutrition', name: 'ì‹í’ˆì˜ì–‘í•™ê³¼', category: 'ë³´ê±´ìƒëª…ê³„ì—´' },
            { id: 'companionAnimalHealth', name: 'ë°˜ë ¤ë™ë¬¼ë³´ê±´ê³¼', category: 'ë³´ê±´ìƒëª…ê³„ì—´' },
            { id: 'companionAnimalIndustry', name: 'ë°˜ë ¤ë™ë¬¼ì‚°ì—…ê³¼', category: 'ë³´ê±´ìƒëª…ê³„ì—´' },
            
            // ê´€ê´‘ì¡°ë¦¬ê³„ì—´
            { id: 'aviationService', name: 'í•­ê³µì„œë¹„ìŠ¤ê³¼', category: 'ê´€ê´‘ì¡°ë¦¬ê³„ì—´' },
            { id: 'tourismEnglish', name: 'ê´€ê´‘ì˜ì–´ê³¼', category: 'ê´€ê´‘ì¡°ë¦¬ê³„ì—´' },
            { id: 'hotelTourism', name: 'í˜¸í…”ê´€ê´‘ê³¼', category: 'ê´€ê´‘ì¡°ë¦¬ê³„ì—´' },
            { id: 'hotelCulinary', name: 'í˜¸í…”ì™¸ì‹ì¡°ë¦¬ê³¼', category: 'ê´€ê´‘ì¡°ë¦¬ê³„ì—´' },
            { id: 'cafeBakery', name: 'ì¹´í˜Â·ë² ì´ì»¤ë¦¬ê³¼', category: 'ê´€ê´‘ì¡°ë¦¬ê³„ì—´' },
            { id: 'hotelFoodManagement', name: 'í˜¸í…”ì™¸ì‹ê²½ì˜ì „ê³µ', category: 'ê´€ê´‘ì¡°ë¦¬ê³„ì—´' },
            
            // ê³µí†µê³„ì—´
            { id: 'liberalArts', name: 'ììœ ì „ê³µí•™ê³¼(ì‹ ì„¤)', category: 'ê³µí†µê³„ì—´' }
        ];

        let currentHighlightIndex = -1;
        let currentFilteredDepartments = [];
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
        document.addEventListener('DOMContentLoaded', function() {
            // ë¡œê·¸ì¸ ìƒíƒœ ì²´í¬
            checkLoginStatus();
            
            // í¼ ì…ë ¥ í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
            setupFormValidation();
            
            // í•™ê³¼ ìë™ì™„ì„± ì„¤ì •
            setupDepartmentAutocomplete();
        });
        
        // í•™ê³¼ ìë™ì™„ì„± ì„¤ì • í•¨ìˆ˜
        function setupDepartmentAutocomplete() {
            const departmentInput = document.getElementById('department');
            const dropdown = document.getElementById('departmentDropdown');
            
            // ì…ë ¥ ì´ë²¤íŠ¸
            departmentInput.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                filterDepartments(value);
            });
            
            // í¬ì»¤ìŠ¤ ì´ë²¤íŠ¸
            departmentInput.addEventListener('focus', function() {
                const value = this.value.toLowerCase();
                filterDepartments(value);
            });
            
            // ë¸”ëŸ¬ ì´ë²¤íŠ¸ (ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ì–´ í´ë¦­ ì´ë²¤íŠ¸ê°€ ë¨¼ì € ì‹¤í–‰ë˜ë„ë¡)
            departmentInput.addEventListener('blur', function() {
                setTimeout(() => {
                    hideDropdown();
                }, 200);
            });
            
            // í‚¤ë³´ë“œ ì´ë²¤íŠ¸
            departmentInput.addEventListener('keydown', function(e) {
                const items = dropdown.querySelectorAll('.autocomplete-item');
                const maxIndex = items.length - 1;
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    currentHighlightIndex = Math.min(currentHighlightIndex + 1, maxIndex);
                    updateHighlight();
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    currentHighlightIndex = Math.max(currentHighlightIndex - 1, -1);
                    updateHighlight();
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (currentHighlightIndex >= 0 && items[currentHighlightIndex]) {
                        const selectedDept = currentFilteredDepartments[currentHighlightIndex];
                        selectDepartment(selectedDept);
                    }
                } else if (e.key === 'Escape') {
                    hideDropdown();
                }
            });
            
            // ë¬¸ì„œ í´ë¦­ ì´ë²¤íŠ¸ (ë“œë¡­ë‹¤ìš´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°)
            document.addEventListener('click', function(e) {
                if (!departmentInput.contains(e.target) && !dropdown.contains(e.target)) {
                    hideDropdown();
                }
            });
        }
        
        // í•™ê³¼ í•„í„°ë§ í•¨ìˆ˜
        function filterDepartments(value) {
            const dropdown = document.getElementById('departmentDropdown');
            
            if (!value) {
                currentFilteredDepartments = [...departments];
            } else {
                currentFilteredDepartments = departments.filter(dept => 
                    dept.name.toLowerCase().includes(value)
                );
            }
            
            if (currentFilteredDepartments.length > 0) {
                showDropdown();
                renderDropdownItems();
            } else {
                hideDropdown();
            }
        }
        
        // ë“œë¡­ë‹¤ìš´ í•­ëª© ë Œë”ë§
        function renderDropdownItems() {
            const dropdown = document.getElementById('departmentDropdown');
            dropdown.innerHTML = '';
            
            // ê³„ì—´ë³„ë¡œ ê·¸ë£¹í™”
            const groupedDepts = {};
            currentFilteredDepartments.forEach(dept => {
                if (!groupedDepts[dept.category]) {
                    groupedDepts[dept.category] = [];
                }
                groupedDepts[dept.category].push(dept);
            });
            
            // ê³„ì—´ ìˆœì„œ ì •ì˜
            const categoryOrder = [
                'ìŠ¤ë§ˆíŠ¸ ICTê³„ì—´',
                'ë¼ì´í”„ë””ìì¸ê³„ì—´', 
                'ë¬¸í™”ì½˜í…ì¸ ê³„ì—´',
                'ì‚¬íšŒÂ·êµìœ¡ê³„ì—´',
                'ë³´ê±´ìƒëª…ê³„ì—´',
                'ê´€ê´‘ì¡°ë¦¬ê³„ì—´',
                'ê³µí†µê³„ì—´'
            ];
            
            let itemIndex = 0;
            categoryOrder.forEach(category => {
                if (groupedDepts[category] && groupedDepts[category].length > 0) {
                    // ê³„ì—´ í—¤ë” ì¶”ê°€
                    const categoryHeader = document.createElement('div');
                    categoryHeader.className = 'autocomplete-category';
                    categoryHeader.textContent = category;
                    dropdown.appendChild(categoryHeader);
                    
                    // í•´ë‹¹ ê³„ì—´ì˜ í•™ê³¼ë“¤ ì¶”ê°€
                    groupedDepts[category].forEach(dept => {
                        const item = document.createElement('div');
                        item.className = 'autocomplete-item';
                        item.textContent = dept.name;
                        item.setAttribute('data-index', itemIndex);
                        item.addEventListener('click', () => selectDepartment(dept));
                        dropdown.appendChild(item);
                        itemIndex++;
                    });
                }
            });
            
            currentHighlightIndex = -1;
        }
        
        // í•˜ì´ë¼ì´íŠ¸ ì—…ë°ì´íŠ¸
        function updateHighlight() {
            const items = document.querySelectorAll('.autocomplete-item');
            items.forEach((item, index) => {
                if (index === currentHighlightIndex) {
                    item.classList.add('highlighted');
                    // ìŠ¤í¬ë¡¤í•˜ì—¬ ì„ íƒëœ í•­ëª©ì´ ë³´ì´ë„ë¡ ì¡°ì •
                    item.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
                } else {
                    item.classList.remove('highlighted');
                }
            });
        }
        
        // í•™ê³¼ ì„ íƒ
        function selectDepartment(dept) {
            const departmentInput = document.getElementById('department');
            departmentInput.value = dept.name;
            departmentInput.setAttribute('data-id', dept.id);
            hideDropdown();
        }
        
        // ë“œë¡­ë‹¤ìš´ í‘œì‹œ
        function showDropdown() {
            const dropdown = document.getElementById('departmentDropdown');
            dropdown.style.display = 'block';
        }
        
        // ë“œë¡­ë‹¤ìš´ ìˆ¨ê¸°ê¸°
        function hideDropdown() {
            const dropdown = document.getElementById('departmentDropdown');
            dropdown.style.display = 'none';
            currentHighlightIndex = -1;
        }
        
        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ ë° í”„ë¡œí•„ ì •ë³´ ë¡œë“œ
        function checkLoginStatus() {
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í˜„ì¬ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const currentUser = localStorage.getItem('currentLoggedInUser');
            
            if (!currentUser) {
                // ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ê²½ìš° ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.');
                window.location.href = 'login.html';
                return;
            }
            
            // í”„ë¡œí•„ ì •ë³´ ë¡œë“œ
            loadProfileInfo(currentUser);
        }
        
        // í”„ë¡œí•„ ì •ë³´ ë¡œë“œ - ìˆ˜ì •ëœ ë²„ì „
        function loadProfileInfo(userId) {
            // ë©”ì¸ í˜ì´ì§€ì™€ ë™ì¼í•œ í•™ë²ˆ í‘œì‹œ ë¡œì§ ì‚¬ìš©
            // studentId í‚¤ì—ì„œ ì‹¤ì œ í•™ë²ˆ ê°€ì ¸ì˜¤ê¸°
            let displayStudentId = localStorage.getItem(`user_${userId}_studentId`) || userId;
            
            // í•™ë²ˆ ì„¤ì •
            document.getElementById('studentId').value = displayStudentId;
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const name = localStorage.getItem(`user_${userId}_name`) || 'ì—°ì„±ëŒ€í•™êµ';
            const departmentId = localStorage.getItem(`user_${userId}_department`) || '';
            const grade = localStorage.getItem(`user_${userId}_grade`) || '2';
            const email = localStorage.getItem(`user_${userId}_email`) || 'test@test';
            const phone = localStorage.getItem(`user_${userId}_phone`) || '010-3402-3447';
            
            // í•™ê³¼ ì´ë¦„ ì°¾ê¸°
            const department = departments.find(dept => dept.id === departmentId);
            const departmentName = department ? department.name : '';
            
            // í”„ë¡œí•„ ì´ë¯¸ì§€ ê´€ë ¨ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const profileImageType = localStorage.getItem(`user_${userId}_profileImageType`) || 'emoji';
            const profileImage = localStorage.getItem(`user_${userId}_profileImage`) || 'ğŸ‘¨â€ğŸ“';
            const customProfileImage = localStorage.getItem(`user_${userId}_customProfileImage`);
            
            // í¼ì— ì •ë³´ ì„¤ì •
            document.getElementById('name').value = name;
            document.getElementById('department').value = departmentName;
            document.getElementById('department').setAttribute('data-id', departmentId);
            document.getElementById('grade').value = grade;
            document.getElementById('email').value = email;
            document.getElementById('phone').value = phone;
            
            // í”„ë¡œí•„ ì´ë¯¸ì§€ ì„¤ì •
            const profileImageElement = document.getElementById('profileImage');
            const headerProfileElement = document.getElementById('headerProfileImage');
            
            if (profileImageType === 'emoji') {
                profileImageElement.innerHTML = profileImage;
                headerProfileElement.innerHTML = profileImage;
            } else if (profileImageType === 'image') {
                profileImageElement.innerHTML = `<img src="${profileImage}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                headerProfileElement.innerHTML = `<img src="${profileImage}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
            } else if (profileImage === 'custom' && customProfileImage) {
                // ì—¬ê¸°ì„œ custom í…ìŠ¤íŠ¸ ëŒ€ì‹  ì‹¤ì œ ì´ë¯¸ì§€ í‘œì‹œ
                profileImageElement.innerHTML = `<img src="${customProfileImage}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                headerProfileElement.innerHTML = `<img src="${customProfileImage}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
            } else {
                profileImageElement.innerHTML = 'ğŸ‘¨â€ğŸ“';
                headerProfileElement.innerHTML = 'ğŸ‘¨â€ğŸ“';
            }
        }
        
        // í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€ê²½ í•¨ìˆ˜ - UI ê°œì„  ë²„ì „
        function changeProfileImage() {
            // í”„ë¡œí•„ ì´ë¯¸ì§€ ì˜µì…˜ ë°°ì—´
            const profileImages = [
                { type: 'emoji', value: 'ğŸ‘¨â€ğŸ“' },
                { type: 'emoji', value: 'ğŸ‘©â€ğŸ“' },
                { type: 'emoji', value: 'ğŸ‘¨â€ğŸ’¼' },
                { type: 'emoji', value: 'ğŸ‘©â€ğŸ’¼' },
                { type: 'emoji', value: 'ğŸ‘¨â€ğŸ«' },
                { type: 'emoji', value: 'ğŸ‘©â€ğŸ«' },
                { type: 'emoji', value: 'ğŸ‘¨â€ğŸ”¬' },
                { type: 'emoji', value: 'ğŸ‘©â€ğŸ”¬' },
                { type: 'emoji', value: 'ğŸ‘¨â€ğŸ’»' },
                { type: 'emoji', value: 'ğŸ‘©â€ğŸ’»' }
            ];
            
            // ëª¨ë‹¬ ì»¨í…Œì´ë„ˆ ìƒì„±
            const modalContainer = document.createElement('div');
            modalContainer.className = 'modal-container';
            modalContainer.id = 'profileImageModal';
            
            // ëª¨ë‹¬ ë‚´ìš©
            const modalContent = document.createElement('div');
            modalContent.className = 'modal-content';
            
            // ëª¨ë‹¬ í—¤ë”
            const modalHeader = document.createElement('div');
            modalHeader.className = 'modal-header';
            modalHeader.innerHTML = '<h3 class="modal-title">í”„ë¡œí•„ ì´ë¯¸ì§€ ì„ íƒ</h3>';
            
            // ì‚¬ì§„ ì—…ë¡œë“œ ì„¹ì…˜
            const uploadSection = document.createElement('div');
            uploadSection.className = 'modal-section';
            
            // ì—…ë¡œë“œ ë²„íŠ¼
            const uploadLabel = document.createElement('label');
            uploadLabel.className = 'upload-button';
            uploadLabel.htmlFor = 'imageUpload';
            uploadLabel.textContent = 'ì‚¬ì§„ ì—…ë¡œë“œ';
            
            const uploadInput = document.createElement('input');
            uploadInput.type = 'file';
            uploadInput.id = 'imageUpload';
            uploadInput.accept = 'image/*';
            uploadInput.style.display = 'none';
            uploadInput.addEventListener('change', handleImageUpload);
            
            const previewContainer = document.createElement('div');
            previewContainer.className = 'preview-container';
            previewContainer.id = 'previewContainer';
            
            uploadSection.appendChild(uploadLabel);
            uploadSection.appendChild(uploadInput);
            uploadSection.appendChild(previewContainer);
            
            // ê¸°ë³¸ ì´ë¯¸ì§€ ì„¹ì…˜
            const emojiSection = document.createElement('div');
            emojiSection.className = 'modal-section';
            
            const emojiTitle = document.createElement('h4');
            emojiTitle.className = 'modal-section-title';
            emojiTitle.textContent = 'ê¸°ë³¸ ì´ë¯¸ì§€';
            
            const emojiGrid = document.createElement('div');
            emojiGrid.className = 'image-grid';
            
            // ì´ëª¨í‹°ì½˜ ì˜µì…˜ ì¶”ê°€
            profileImages.forEach(image => {
                const option = document.createElement('div');
                option.className = 'image-option';
                option.onclick = () => selectProfileImage(image.value, 'emoji');
                
                const emoji = document.createElement('div');
                emoji.className = 'emoji-image';
                emoji.textContent = image.value;
                
                option.appendChild(emoji);
                emojiGrid.appendChild(option);
            });
            
            emojiSection.appendChild(emojiTitle);
            emojiSection.appendChild(emojiGrid);
            
            // ëª¨ë‹¬ í‘¸í„° (ë‹«ê¸° ë²„íŠ¼)
            const modalFooter = document.createElement('div');
            modalFooter.className = 'modal-footer';
            modalFooter.textContent = 'ë‹«ê¸°';
            modalFooter.onclick = closeProfileImageModal;
            
            // ëª¨ë‹¬ ë‚´ìš© ì¡°ë¦½
            modalContent.appendChild(modalHeader);
            modalContent.appendChild(uploadSection);
            modalContent.appendChild(emojiSection);
            modalContent.appendChild(modalFooter);
            
            modalContainer.appendChild(modalContent);
            
            // ëª¨ë‹¬ í‘œì‹œ
            document.body.appendChild(modalContainer);
        }

        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬ í•¨ìˆ˜
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const previewContainer = document.getElementById('previewContainer');
                    previewContainer.innerHTML = '';
                    
                    // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
                    const imagePreview = document.createElement('img');
                    imagePreview.className = 'preview-image';
                    imagePreview.src = e.target.result;
                    
                    // ì ìš© ë²„íŠ¼
                    const applyButton = document.createElement('button');
                    applyButton.className = 'apply-button';
                    applyButton.textContent = 'ì´ ì‚¬ì§„ìœ¼ë¡œ ì„¤ì •';
                    applyButton.onclick = function() {
                        uploadCustomImage(e.target.result);
                    };
                    
                    previewContainer.appendChild(imagePreview);
                    previewContainer.appendChild(applyButton);
                    previewContainer.style.display = 'block';
                };
                
                reader.readAsDataURL(file);
            }
        }

        // ì‚¬ìš©ì ì§€ì • ì´ë¯¸ì§€ ì„¤ì • - ìˆ˜ì •ëœ ë²„ì „
        function uploadCustomImage(imageData) {
            // ì´ë¯¸ì§€ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
            const profileImageElement = document.getElementById('profileImage');
            profileImageElement.innerHTML = `<img src="${imageData}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
            
            // í—¤ë” í”„ë¡œí•„ ì´ë¯¸ì§€ë„ ì—…ë°ì´íŠ¸
            const headerProfileElement = document.getElementById('headerProfileImage');
            headerProfileElement.innerHTML = `<img src="${imageData}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            const studentId = document.getElementById('studentId').value;
            const currentUser = localStorage.getItem('currentLoggedInUser');
            
            localStorage.setItem(`user_${currentUser}_profileImageType`, 'custom');
            localStorage.setItem(`user_${currentUser}_profileImage`, 'custom');
            localStorage.setItem(`user_${currentUser}_customProfileImage`, imageData);
            
            // ëª¨ë‹¬ ë‹«ê¸°
            closeProfileImageModal();
            
            // ë¶€ëª¨ ì°½(ë©”ì¸ ì•±)ì— ì´ë²¤íŠ¸ë¥¼ ì „ì†¡í•˜ì—¬ í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
            updateParentWindowProfileImage(imageData);
        }
        
        // ë¶€ëª¨ ì°½ì˜ í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateParentWindowProfileImage(imageData) {
            try {
                // ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œì¼œ ë©”ì¸ ì•±ì— ì•Œë¦¼
                localStorage.setItem('profileImageUpdated', 'true');
                
                // í˜¹ì‹œ ë¶€ëª¨ ì°½ì´ ìˆë‹¤ë©´ ì§ì ‘ ì ‘ê·¼
                if (window.opener && !window.opener.closed) {
                    window.opener.updateProfileImage(imageData);
                }
            } catch (e) {
                console.log('ë¶€ëª¨ ì°½ ì—…ë°ì´íŠ¸ ì‹œë„ ì¤‘ ì˜¤ë¥˜:', e);
            }
        }

        // í”„ë¡œí•„ ì´ë¯¸ì§€ ì„ íƒ í•¨ìˆ˜ - ìˆ˜ì •ëœ ë²„ì „
        function selectProfileImage(image, type) {
            // ì„ íƒí•œ ì´ë¯¸ì§€ë¡œ í”„ë¡œí•„ ì´ë¯¸ì§€ ë³€ê²½
            const profileImageElement = document.getElementById('profileImage');
            const headerProfileElement = document.getElementById('headerProfileImage');
            
            if (type === 'emoji') {
                profileImageElement.innerHTML = image;
                headerProfileElement.innerHTML = image;
            } else {
                profileImageElement.innerHTML = `<img src="${image}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                headerProfileElement.innerHTML = `<img src="${image}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
            }
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            const currentUser = localStorage.getItem('currentLoggedInUser');
            localStorage.setItem(`user_${currentUser}_profileImageType`, type);
            localStorage.setItem(`user_${currentUser}_profileImage`, image);
            
            // ëª¨ë‹¬ ë‹«ê¸°
            closeProfileImageModal();
            
            // ë¶€ëª¨ ì°½ ì—…ë°ì´íŠ¸
            if (type === 'emoji') {
                updateParentWindowProfileEmoji(image);
            }
        }
        
        // ë¶€ëª¨ ì°½ì˜ ì´ëª¨ì§€ í”„ë¡œí•„ ì—…ë°ì´íŠ¸
        function updateParentWindowProfileEmoji(emoji) {
            try {
                localStorage.setItem('profileEmojiUpdated', 'true');
                localStorage.setItem('profileEmojiValue', emoji);
                
                if (window.opener && !window.opener.closed) {
                    window.opener.updateProfileEmoji(emoji);
                }
            } catch (e) {
                console.log('ë¶€ëª¨ ì°½ ì´ëª¨ì§€ ì—…ë°ì´íŠ¸ ì‹œë„ ì¤‘ ì˜¤ë¥˜:', e);
            }
        }

        // í”„ë¡œí•„ ì´ë¯¸ì§€ ëª¨ë‹¬ ë‹«ê¸° í•¨ìˆ˜
        function closeProfileImageModal() {
            const modal = document.getElementById('profileImageModal');
            if (modal) {
                document.body.removeChild(modal);
            }
        }
        
        // í¼ ìœ íš¨ì„± ê²€ì‚¬ ì„¤ì •
        function setupFormValidation() {
            const emailInput = document.getElementById('email');
            const phoneInput = document.getElementById('phone');
            const newPasswordInput = document.getElementById('newPassword');
            const confirmPasswordInput = document.getElementById('confirmPassword');
            
            // ì´ë©”ì¼ ì…ë ¥ ê²€ì‚¬
            emailInput.addEventListener('blur', function() {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                const isValid = emailRegex.test(this.value);
                validateField(this, isValid);
            });
            
            // ì „í™”ë²ˆí˜¸ ì…ë ¥ ê²€ì‚¬
            phoneInput.addEventListener('blur', function() {
                const phoneRegex = /^010-\d{4}-\d{4}$/;
                const isValid = phoneRegex.test(this.value);
                validateField(this, isValid);
            });
            
            // ìƒˆ ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì¼ì¹˜ ê²€ì‚¬
            confirmPasswordInput.addEventListener('input', function() {
                const isValid = this.value === newPasswordInput.value;
                validateField(this, isValid);
            });
        }
        
        // í•„ë“œ ìœ íš¨ì„± ê²€ì‚¬ ë° ì—ëŸ¬ í‘œì‹œ
        function validateField(field, isValid) {
            const formGroup = field.parentElement;
            
            if (!isValid && field.value.trim() !== '') {
                formGroup.classList.add('has-error');
            } else {
                formGroup.classList.remove('has-error');
            }
        }

        // í”„ë¡œí•„ ì €ì¥ - ìˆ˜ì •ëœ ë²„ì „
        function saveProfile(event) {
            event.preventDefault();
            
            // í•„ìˆ˜ ì…ë ¥ ê²€ì‚¬
            const name = document.getElementById('name').value.trim();
            const departmentName = document.getElementById('department').value.trim();
            const departmentId = document.getElementById('department').getAttribute('data-id');
            const grade = document.getElementById('grade').value;
            const email = document.getElementById('email').value.trim();
            const phone = document.getElementById('phone').value.trim();
            
            if (!name || !departmentName || !grade || !email || !phone) {
                alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return false;
            }
            
            // í•™ê³¼ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
            if (!departmentId) {
                alert('ì˜¬ë°”ë¥¸ í•™ê³¼ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return false;
            }
            
            // ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ê²€ì‚¬
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (newPassword) {
                if (!currentPassword) {
                    alert('í˜„ì¬ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return false;
                }
                
                if (newPassword !== confirmPassword) {
                    alert('ìƒˆ ë¹„ë°€ë²ˆí˜¸ì™€ í™•ì¸ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                    return false;
                }
                
                // ë¹„ë°€ë²ˆí˜¸ ì •ì±… ê²€ì‚¬ (ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì ì¡°í•© 8ì ì´ìƒ)
                const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,}$/;
                if (!passwordRegex.test(newPassword)) {
                    alert('ë¹„ë°€ë²ˆí˜¸ëŠ” ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•˜ì—¬ 8ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                    return false;
                }
            }
            
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
            const currentUser = localStorage.getItem('currentLoggedInUser');
            localStorage.setItem(`user_${currentUser}_name`, name);
            localStorage.setItem(`user_${currentUser}_department`, departmentId);
            localStorage.setItem(`user_${currentUser}_grade`, grade);
            localStorage.setItem(`user_${currentUser}_email`, email);
            localStorage.setItem(`user_${currentUser}_phone`, phone);
            
            if (newPassword) {
                localStorage.setItem(`user_${currentUser}_password`, newPassword);
            }
            
            // í”„ë¡œí•„ ì´ë¯¸ì§€ ì •ë³´ ê°€ì ¸ì˜¤ê¸° (ì´ë¯¸ ìˆëŠ” ê²½ìš° ì—…ë°ì´íŠ¸ë˜ì—ˆì„ ê²ƒì„)
            const profileImageType = localStorage.getItem(`user_${currentUser}_profileImageType`) || 'emoji';
            const profileImage = localStorage.getItem(`user_${currentUser}_profileImage`) || 'ğŸ‘¨â€ğŸ“';
            const customProfileImage = localStorage.getItem(`user_${currentUser}_customProfileImage`);
            
            // ëª¨ë“  í˜ì´ì§€ì— í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸ë¥¼ ì•Œë¦¬ëŠ” í”Œë˜ê·¸ ì„¤ì •
            localStorage.setItem('profileUpdated', 'true');
            
            alert('ê°œì¸ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
            
            // ì´ì „ í˜ì´ì§€ë¡œ ì´ë™
            goToBack();
            
            return false;
        }

        // ì´ì „ í˜ì´ì§€ë¡œ ì´ë™
        function goToBack() {
            window.history.back();
        }
    </script>
</body>
</html>