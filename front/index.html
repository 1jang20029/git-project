<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>연성대학교 스마트 캠퍼스 - 디버그</title>

  <!-- 네이버 지도 API -->
  <script src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=5qggqdvx3j&submodules=direction" defer></script>
  
  <!-- CSS 파일들 -->
  <link rel="stylesheet" href="./css/index.css" />
  
  <style>
    /* 기본 스타일 - CSS 파일이 없을 경우를 대비 */
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a2e;
      color: white;
    }
    
    #top-nav {
      background: #16213e;
      padding: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    #nav-brand {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.2rem;
      font-weight: bold;
    }
    
    #main-menu {
      display: flex;
      list-style: none;
      margin: 0;
      padding: 0;
      gap: 1rem;
    }
    
    .nav-item {
      padding: 0.5rem 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .nav-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .nav-item.active {
      background: #0f3460;
    }
    
    #main-container {
      padding: 2rem;
    }
    
    .debug-info {
      background: #333;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 8px;
      border-left: 4px solid #4CAF50;
    }
    
    .error-info {
      background: #333;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 8px;
      border-left: 4px solid #f44336;
    }
  </style>
</head>
<body>
  <nav id="top-nav">
    <div id="nav-brand">
      <span>🎓</span>
      <span>연성대학교 스마트 캠퍼스</span>
    </div>
    <ul id="main-menu">
      <li class="nav-item active" id="nav-home" onclick="showContent('home')">
        <span>🏠 대시보드</span>
      </li>
      <li class="nav-item" id="nav-buildings" onclick="showContent('buildings')">
        <span>🏢 건물정보</span>
      </li>
    </ul>
  </nav>

  <div id="main-container">
    <div id="debug-status">
      <h2>🔧 시스템 진단</h2>
      <div id="debug-results"></div>
    </div>
    
    <div id="homeContent">
      <h1>대시보드</h1>
      <p>메인 콘텐츠 영역입니다.</p>
    </div>
    
    <div id="buildingsContent" style="display:none;">
      <h1>건물 정보</h1>
      <p>건물 정보 페이지입니다.</p>
    </div>
  </div>

  <!-- 디버깅용 스크립트 -->
  <script>
    console.log('🚀 디버그 스크립트 시작');
    
    // 디버그 정보 표시 함수
    function showDebugInfo() {
      const debugDiv = document.getElementById('debug-results');
      const results = [];
      
      // 1. 모듈 로드 상태 확인
      const modules = [
        'AppState', 'Utils', 'NetworkManager', 'DataManager', 
        'UIRenderer', 'NavigationManager', 'DropdownManager', 
        'EventManager', 'SessionManager', 'MapManager'
      ];
      
      results.push('<h3>📦 모듈 로드 상태</h3>');
      modules.forEach(module => {
        const loaded = window[module] ? '✅' : '❌';
        const className = window[module] ? 'debug-info' : 'error-info';
        results.push(`<div class="${className}">${loaded} ${module}</div>`);
      });
      
      // 2. 네이버 지도 API 상태 확인
      results.push('<h3>🗺️ 네이버 지도 API</h3>');
      const mapStatus = typeof naver !== 'undefined' && naver.maps ? '✅ 로드됨' : '❌ 로드 실패';
      const mapClassName = typeof naver !== 'undefined' ? 'debug-info' : 'error-info';
      results.push(`<div class="${mapClassName}">${mapStatus}</div>`);
      
      // 3. DOM 요소 확인
      results.push('<h3>🎯 DOM 요소</h3>');
      const elements = ['nav-home', 'nav-buildings', 'homeContent', 'buildingsContent'];
      elements.forEach(id => {
        const element = document.getElementById(id);
        const status = element ? '✅ 존재' : '❌ 없음';
        const className = element ? 'debug-info' : 'error-info';
        results.push(`<div class="${className}">${status} #${id}</div>`);
      });
      
      debugDiv.innerHTML = results.join('');
    }
    
    // 기본 showContent 함수 (모듈이 로드되지 않은 경우 대비)
    function showContent(type) {
      console.log(`🎯 showContent 호출: ${type}`);
      
      // 모든 콘텐츠 숨기기
      const contents = ['homeContent', 'buildingsContent'];
      contents.forEach(id => {
        const element = document.getElementById(id);
        if (element) element.style.display = 'none';
      });
      
      // 선택된 콘텐츠 표시
      const targetElement = document.getElementById(type + 'Content');
      if (targetElement) {
        targetElement.style.display = 'block';
        console.log(`✅ ${type} 콘텐츠 표시됨`);
      } else {
        console.error(`❌ ${type}Content 요소를 찾을 수 없음`);
      }
      
      // 네비게이션 활성 상태 업데이트
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      
      const navItem = document.getElementById('nav-' + type);
      if (navItem) {
        navItem.classList.add('active');
      }
    }
    
    // 페이지 로드 후 진단 실행
    document.addEventListener('DOMContentLoaded', () => {
      console.log('📱 DOM 로드 완료');
      setTimeout(showDebugInfo, 1000); // 1초 후 진단 실행
    });
  </script>

  <!-- 모듈 파일들 로드 시도 -->
  <script>
    // 파일 로드 상태 확인을 위한 함수들
    function loadScript(src, name) {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = src;
        script.onload = () => {
          console.log(`✅ ${name} 로드 성공`);
          resolve();
        };
        script.onerror = () => {
          console.error(`❌ ${name} 로드 실패: ${src}`);
          reject(new Error(`Failed to load ${name}`));
        };
        document.head.appendChild(script);
      });
    }
    
    // 순차적으로 모듈 로드
    async function loadModules() {
      const modules = [
        { src: './js/index/app-state.js', name: 'AppState' },
        { src: './js/index/utils.js', name: 'Utils' },
        { src: './js/index/network-manager.js', name: 'NetworkManager' },
        { src: './js/index/data-manager.js', name: 'DataManager' },
        { src: './js/index/ui-renderer.js', name: 'UIRenderer' },
        { src: './js/index/navigation-manager.js', name: 'NavigationManager' },
        { src: './js/index/dropdown-manager.js', name: 'DropdownManager' },
        { src: './js/index/event-manager.js', name: 'EventManager' },
        { src: './js/index/session-manager.js', name: 'SessionManager' },
        { src: './js/index/map-manager.js', name: 'MapManager' },
        { src: './js/index/main.js', name: 'Main' },
        { src: './js/compatibility.js', name: 'Compatibility' }
      ];
      
      for (const module of modules) {
        try {
          await loadScript(module.src, module.name);
        } catch (error) {
          console.error(`모듈 로드 중 오류:`, error);
          // 로드 실패해도 계속 진행
        }
      }
      
      console.log('📦 모든 모듈 로드 시도 완료');
      setTimeout(showDebugInfo, 500); // 다시 진단
    }
    
    // DOM 로드 후 모듈 로드 시작
    document.addEventListener('DOMContentLoaded', loadModules);
  </script>
</body>
</html>