<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>아이디 - 비밀번호 찾기 - 연성대학교</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
        }
        
        .container {
            max-width: 768px;
            margin: 0 auto;
            background-color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        header {
            background-color: #c62917;
            color: white;
            padding: 12px 16px;
            display: flex;
            align-items: center;
        }
        
        .back-button {
            font-size: 20px;
            margin-right: 16px;
            cursor: pointer;
        }
        
        .header-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        .content-container {
            padding: 20px;
            flex: 1;
        }
        
        .tabs {
            display: flex;
            border: 1px solid #ddd;
            margin-bottom: 20px;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            background-color: #f8f8f8;
        }
        
        .tab.active {
            background-color: #fff;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .form-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            margin-bottom: 8px;
            color: #333;
        }
        
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .verification-group {
            display: flex;
            gap: 10px;
        }
        
        .verification-input {
            flex: 1;
        }
        
        .timer {
            color: #f44336;
            font-size: 14px;
            margin-left: 5px;
        }
        
        .verification-text {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .button {
            width: 100%;
            padding: 12px;
            background-color: #5e50f9;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
        }
        
        .button-secondary {
            background-color: #6c757d;
        }
        
        .result-container {
            margin-top: 20px;
            padding: 20px;
            background-color: #f8f8f8;
            border-radius: 4px;
            border: 1px solid #ddd;
            display: none;
        }
        
        .result-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .result-info {
            background-color: white;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin-bottom: 15px;
            font-weight: bold;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="back-button" onclick="goBack()">←</div>
            <div class="header-title">아이디 - 비밀번호 찾기</div>
        </header>
        
        <div class="content-container">
            <div class="tabs">
                <div class="tab active" onclick="switchTab('id-tab')">아이디 찾기</div>
                <div class="tab" onclick="switchTab('pw-tab')">비밀번호 찾기</div>
            </div>
            
            <!-- 아이디 찾기 탭 내용 -->
            <div id="id-tab" class="tab-content active">
                <h2 class="form-title">아이디 · 비밀번호 찾기</h2>
                
                <div class="tabs">
                    <div class="tab active" onclick="switchIdMethod('name-id')">이름/학번으로 찾기</div>
                    <div class="tab" onclick="switchIdMethod('phone')">휴대폰으로 찾기</div>
                </div>
                
                <!-- 이름/학번으로 찾기 -->
                <div id="name-id-method" class="tab-content active">
                    <div class="form-group">
                        <label class="form-label">이름</label>
                        <input type="text" class="form-input" id="name-input" placeholder="이름을 입력하세요">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">학번</label>
                        <input type="text" class="form-input" id="student-id-input" placeholder="학번을 입력하세요">
                    </div>
                    
                    <button class="button" onclick="findIdByNameAndStudentId()">아이디 찾기</button>
                </div>
                
                <!-- 휴대폰으로 찾기 -->
                <div id="phone-method" class="tab-content">
                    <div class="form-group">
                        <label class="form-label">이름</label>
                        <input type="text" class="form-input" id="name-phone-input" placeholder="이름을 입력하세요">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">휴대폰 번호</label>
                        <input type="tel" class="form-input" id="phone-input" placeholder="휴대폰 번호 입력">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">인증번호</label>
                        <div class="verification-group">
                            <input type="text" class="form-input verification-input" id="verification-input" placeholder="인증번호 입력">
                            <button class="button button-secondary" onclick="sendVerificationCode()">인증번호 전송</button>
                        </div>
                        <div class="verification-text">인증번호 전송을 누르시면 인증번호가 전송됩니다. <span class="timer" id="id-timer"></span></div>
                    </div>
                    
                    <button class="button" onclick="findIdByPhone()">아이디 찾기</button>
                </div>
                
                <!-- 아이디 찾기 결과 -->
                <div id="id-result" class="result-container">
                    <div class="result-title">가입한 아이디는 아래와 같습니다.</div>
                    <div class="result-info" id="found-id">user12345</div>
                </div>
            </div>
            
            <!-- 비밀번호 찾기 탭 내용 -->
            <div id="pw-tab" class="tab-content">
                <h2 class="form-title">새로운 비밀번호를 입력해주세요</h2>
                
                <div class="form-group">
                    <label class="form-label">아이디</label>
                    <input type="text" class="form-input" id="id-input" placeholder="아이디를 입력하세요">
                </div>
                
                <div class="form-group">
                    <label class="form-label">현재 비밀번호</label>
                    <input type="password" class="form-input" id="current-pw-input" placeholder="현재 비밀번호를 입력하세요">
                </div>
                
                <div class="form-group">
                    <label class="form-label">인증번호</label>
                    <div class="verification-group">
                        <input type="text" class="form-input verification-input" id="pw-verification-input" placeholder="인증번호 입력">
                        <button class="button button-secondary" onclick="sendPwVerificationCode()">인증번호 전송</button>
                    </div>
                    <div class="verification-text">인증번호 전송을 누르시면 인증번호가 전송됩니다. <span class="timer" id="pw-timer"></span></div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">새 비밀번호 입력</label>
                    <input type="password" class="form-input" id="new-pw-input" placeholder="영문, 숫자, 특수문자 8-20자">
                </div>
                
                <div class="form-group">
                    <label class="form-label">새 비밀번호 재입력</label>
                    <input type="password" class="form-input" id="new-pw-confirm-input" placeholder="영문, 숫자, 특수문자 8-20자">
                </div>
                
                <button class="button" onclick="resetPassword()">로그인</button>
            </div>
        </div>
    </div>
    
    <script>
        // 뒤로가기
        function goBack() {
            window.history.back();
        }
        
        // 탭 전환 함수
        function switchTab(tabId) {
            // 모든 탭과 탭 내용 비활성화
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // 선택한 탭 활성화
            if (tabId === 'id-tab') {
                document.querySelectorAll('.tab')[0].classList.add('active');
                document.getElementById('id-tab').classList.add('active');
            } else {
                document.querySelectorAll('.tab')[1].classList.add('active');
                document.getElementById('pw-tab').classList.add('active');
            }
            
            // 결과 컨테이너 숨기기
            document.getElementById('id-result').style.display = 'none';
        }
        
        // 아이디 찾기 방법 전환
        function switchIdMethod(methodId) {
            // 이름/학번 또는 휴대폰 방식 탭 전환
            const tabs = document.querySelectorAll('#id-tab .tabs .tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            if (methodId === 'name-id') {
                tabs[0].classList.add('active');
                document.getElementById('name-id-method').classList.add('active');
                document.getElementById('phone-method').classList.remove('active');
            } else {
                tabs[1].classList.add('active');
                document.getElementById('name-id-method').classList.remove('active');
                document.getElementById('phone-method').classList.add('active');
            }
            
            // 결과 컨테이너 숨기기
            document.getElementById('id-result').style.display = 'none';
        }
        
        // 이름과 학번으로 아이디 찾기
        function findIdByNameAndStudentId() {
            const name = document.getElementById('name-input').value;
            const studentId = document.getElementById('student-id-input').value;
            
            if (!name || !studentId) {
                alert('이름과 학번을 모두 입력해주세요.');
                return;
            }
            
            // 로컬 스토리지에서 등록된 사용자 확인
            const storedName = localStorage.getItem(`user_${studentId}_name`);
            
            // 학번과 이름이 일치하는 경우
            if (storedName === name) {
                // 해당 사용자의 아이디 표시
                const userId = localStorage.getItem(`user_${studentId}_id`);
                if (userId) {
                    document.getElementById('found-id').textContent = userId;
                } else {
                    document.getElementById('found-id').textContent = studentId; // 아이디가 학번인 경우
                }
                
                // 결과 표시
                document.getElementById('id-result').style.display = 'block';
            } else {
                alert('입력하신 정보와 일치하는 회원 정보가 없습니다.');
            }
        }
        
        // 휴대폰으로 아이디 찾기
        function findIdByPhone() {
            const name = document.getElementById('name-phone-input').value;
            const phone = document.getElementById('phone-input').value;
            const verificationCode = document.getElementById('verification-input').value;
            
            if (!name || !phone || !verificationCode) {
                alert('모든 정보를 입력해주세요.');
                return;
            }
            
            // 인증번호 확인 (실제로는 서버에서 확인)
            const storedCode = sessionStorage.getItem('verificationCode');
            if (verificationCode !== storedCode) {
                alert('인증번호가 일치하지 않습니다.');
                return;
            }
            
            // 로컬 스토리지에서 전화번호로 사용자 찾기
            let foundUserId = null;
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.includes('_phone')) {
                    const storedPhone = localStorage.getItem(key);
                    const studentId = key.split('_')[1]; // 학번 추출
                    
                    if (storedPhone === phone) {
                        // 이름 확인
                        const storedName = localStorage.getItem(`user_${studentId}_name`);
                        if (storedName === name) {
                            // 아이디 가져오기
                            foundUserId = localStorage.getItem(`user_${studentId}_id`) || studentId;
                            break;
                        }
                    }
                }
            }
            
            if (foundUserId) {
                // 아이디 표시
                document.getElementById('found-id').textContent = foundUserId;
                document.getElementById('id-result').style.display = 'block';
                
                // 인증번호 세션 삭제
                sessionStorage.removeItem('verificationCode');
            } else {
                alert('입력하신 정보와 일치하는 회원 정보가 없습니다.');
            }
        }
        
        // 인증번호 전송
        function sendVerificationCode() {
            const phone = document.getElementById('phone-input').value;
            
            if (!phone) {
                alert('휴대폰 번호를 입력해주세요.');
                return;
            }
            
            // 가상의 인증번호 생성 (실제로는 서버에서 생성 후 SMS 발송)
            const code = Math.floor(100000 + Math.random() * 900000).toString();
            sessionStorage.setItem('verificationCode', code);
            
            alert(`인증번호가 발송되었습니다: ${code}`);
            
            // 인증번호 타이머 시작 (3분)
            startTimer('id-timer', 180);
        }
        
        // 비밀번호 인증번호 전송
        function sendPwVerificationCode() {
            const userId = document.getElementById('id-input').value;
            const currentPw = document.getElementById('current-pw-input').value;
            
            if (!userId || !currentPw) {
                alert('아이디와 현재 비밀번호를 모두 입력해주세요.');
                return;
            }
            
            // 아이디와 비밀번호 확인
            let isValid = false;
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.includes('_id') && localStorage.getItem(key) === userId) {
                    const studentId = key.split('_')[1]; // 학번 추출
                    const storedPw = localStorage.getItem(`user_${studentId}_pw`);
                    
                    if (storedPw === currentPw) {
                        isValid = true;
                        break;
                    }
                }
            }
            
            if (!isValid) {
                alert('아이디 또는 비밀번호가 일치하지 않습니다.');
                return;
            }
            
            // 가상의 인증번호 생성
            const code = Math.floor(100000 + Math.random() * 900000).toString();
            sessionStorage.setItem('pwVerificationCode', code);
            
            alert(`인증번호가 발송되었습니다: ${code}`);
            
            // 인증번호 타이머 시작 (3분)
            startTimer('pw-timer', 180);
        }
        
        // 타이머 함수
        function startTimer(elementId, seconds) {
            const timerElement = document.getElementById(elementId);
            let remainingTime = seconds;
            
            const timer = setInterval(function() {
                const minutes = Math.floor(remainingTime / 60);
                const seconds = remainingTime % 60;
                
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (--remainingTime < 0) {
                    clearInterval(timer);
                    timerElement.textContent = "인증시간 만료";
                    
                    if (elementId === 'id-timer') {
                        sessionStorage.removeItem('verificationCode');
                    } else {
                        sessionStorage.removeItem('pwVerificationCode');
                    }
                }
            }, 1000);
        }
        
        // 비밀번호 재설정
        function resetPassword() {
            const userId = document.getElementById('id-input').value;
            const currentPw = document.getElementById('current-pw-input').value;
            const verificationCode = document.getElementById('pw-verification-input').value;
            const newPw = document.getElementById('new-pw-input').value;
            const confirmNewPw = document.getElementById('new-pw-confirm-input').value;
            
            if (!userId || !currentPw || !verificationCode || !newPw || !confirmNewPw) {
                alert('모든 항목을 입력해주세요.');
                return;
            }
            
            // 인증번호 확인
            const storedCode = sessionStorage.getItem('pwVerificationCode');
            if (verificationCode !== storedCode) {
                alert('인증번호가 일치하지 않습니다.');
                return;
            }
            
            // 새 비밀번호 확인
            if (newPw !== confirmNewPw) {
                alert('새 비밀번호와 확인이 일치하지 않습니다.');
                return;
            }
            
            // 비밀번호 패턴 확인 (영문, 숫자, 특수문자 포함 8-20자)
            const pwPattern = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]{8,20}$/;
            if (!pwPattern.test(newPw)) {
                alert('비밀번호는 영문, 숫자, 특수문자를 포함하여 8-20자로 입력해주세요.');
                return;
            }
            
            // 로컬 스토리지에서 사용자 찾아 비밀번호 변경
            let userFound = false;
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.includes('_id') && localStorage.getItem(key) === userId) {
                    const studentId = key.split('_')[1]; // 학번 추출
                    const storedPw = localStorage.getItem(`user_${studentId}_pw`);
                    
                    if (storedPw === currentPw) {
                        // 비밀번호 업데이트
                        localStorage.setItem(`user_${studentId}_pw`, newPw);
                        userFound = true;
                        break;
                    }
                }
            }
            
            if (userFound) {
                alert('비밀번호가 성공적으로 변경되었습니다. 새 비밀번호로 로그인해주세요.');
                // 인증번호 세션 삭제
                sessionStorage.removeItem('pwVerificationCode');
                // 로그인 페이지로 이동
                window.location.href = 'login.html';
            } else {
                alert('아이디 또는 비밀번호가 일치하지 않습니다.');
            }
        }
        
        // 페이지 로드 시 로컬 스토리지에 샘플 사용자 데이터 추가 (테스트용)
        window.addEventListener('DOMContentLoaded', function() {
            // 이미 저장된 사용자가 없는 경우에만 샘플 데이터 추가
            if (!localStorage.getItem('user_20211002_name')) {
                // 샘플 사용자1
                localStorage.setItem('user_20211002_name', '김철수');
                localStorage.setItem('user_20211002_id', 'user1234');
                localStorage.setItem('user_20211002_pw', 'Password1!');
                localStorage.setItem('user_20211002_email', 'user1234@example.com');
                localStorage.setItem('user_20211002_phone', '010-1234-5678');
                
                // 샘플 사용자2
                localStorage.setItem('user_20211003_name', '이영희');
                localStorage.setItem('user_20211003_id', 'yeonghi');
                localStorage.setItem('user_20211003_pw', 'Password2@');
                localStorage.setItem('user_20211003_email', 'yeonghi@example.com');
                localStorage.setItem('user_20211003_phone', '010-2345-6789');
            }
        });
    </script>
</body>
</html>